import{c as Ie,f as V,d as Ce,o as ke,j as e,b as _,a as R,K as F,r as y,N as $,T as p,L as P,V as ve,J as te,M as Z,F as De}from"./createReactComponent-WPW12zrK.js";import{E as re,F as Me,v as oe,G as Te,q as ie,H as le,J as ce,K as de,m as S,e as L,N as Be,O as ze,P as Pe,d as Le,o as O,M as Ne,g as Fe,h as Ee,i as we,j as Ae,k as $e,u as He,b as We,f as Ue,L as Ve,Q as _e,T as Re,y as Oe,w as Ge}from"./app-BIM-v5sX.js";import{S as j}from"./SectionTitle-DqBCuc5u.js";import{T as Ke}from"./TagWithIcon-DFTk4qIc.js";import{E as qe,C as Je}from"./EditInMapInputGroup-CadGI3_G.js";import{t as G,T as E,a as me}from"./dateFormating-_VgpDya0.js";import{a as Qe}from"./index.tags-0kB2MkZx.js";import{u as w,a as Xe,c as Ye}from"./common.utils-BDtzQ6xa.js";import{I as N}from"./IconTrash-DVcP6PwM.js";import{I as ue}from"./IconExternalLink-BPR0Htc5.js";import{H as c,C as K,D as ee}from"./icon-BvDSS9q3.js";import{I as he,B as f,F as D,c as ae}from"./icon-white-BiuxQ1Ek.js";import{c as Ze}from"./MyLineChart-Wx5bX5UO.js";import{F as pe}from"./chunk-KRPLQIP4-BfVHV2g3.js";import{T as ea,a as aa,b as sa}from"./chunk-4YMKQ5D4-CC--TXWK.js";import{T as na,a as ta}from"./chunk-IAXSQ4X2-WIPLwa7a.js";import{I as ra}from"./IconUsersGroup-DShnBAGS.js";import{L as oa}from"./chunk-K7XRJ7NL-C_5srjpV.js";import{n as ia,d as la,b as ca}from"./validator.utils-C_TaQQBu.js";import{u as da,c as ma,f as ua,F as M,b as T}from"./index.esm-BStM4cIJ.js";import{T as se}from"./chunk-4IH3O7BJ-s5k9DqCt.js";import{M as ha}from"./index-_9iesu2c.js";import{b as pa,a as xa,D as ga}from"./DeleteReourceButton-CVyCrYbv.js";import{I as ja}from"./IconCalendar-Cc3-gxFV.js";import{I as fa}from"./IconEdit-DF8qT9zS.js";import{I as ne}from"./IconInfoCircle-De_dvTL1.js";import"./GMapsButton-BNhdlxRZ.js";var[ba,xe]=Ie({name:"StatStylesContext",errorMessage:`useStatStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Stat />" `}),H=V(function(n,l){const t=Ce("Stat",n),a={position:"relative",flex:"1 1 0%",...t.container},{className:r,children:o,...u}=ke(n);return e.jsx(ba,{value:t,children:e.jsx(_.div,{ref:l,...u,className:R("chakra-stat",r),__css:a,children:e.jsx("dl",{children:o})})})});H.displayName="Stat";var W=V(function(n,l){const t=xe();return e.jsx(_.dt,{ref:l,...n,className:R("chakra-stat__label",n.className),__css:t.label})});W.displayName="StatLabel";var U=V(function(n,l){const t=xe();return e.jsx(_.dd,{ref:l,...n,className:R("chakra-stat__number",n.className),__css:{...t.number,fontFeatureSettings:"pnum",fontVariantNumeric:"proportional-nums"}})});U.displayName="StatNumber";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Sa=F("outline","chart-bubble","IconChartBubble",[["path",{d:"M6 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-0"}],["path",{d:"M16 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14.5 7.5m-4.5 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 1 0 -9 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ya=F("outline","inner-shadow-top","IconInnerShadowTop",[["path",{d:"M5.636 5.636a9 9 0 1 0 12.728 12.728a9 9 0 0 0 -12.728 -12.728z",key:"svg-0"}],["path",{d:"M16.243 7.757a6 6 0 0 0 -8.486 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ia=F("outline","map-check","IconMapCheck",[["path",{d:"M11 18l-2 -1l-6 3v-13l6 -3l6 3l6 -3v9",key:"svg-0"}],["path",{d:"M9 4v13",key:"svg-1"}],["path",{d:"M15 7v8",key:"svg-2"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ca=F("outline","trending-up","IconTrendingUp",[["path",{d:"M3 17l6 -6l4 4l8 -8",key:"svg-0"}],["path",{d:"M14 7l7 0l0 7",key:"svg-1"}]]);const B=de();function ka({data:i,mutate:n}){let{nodeId:l,countCompanySubscribtion:t}=i;const a=re(),r=`/nodes/${l}/companies`,o=w(),u=s=>{a({title:"Hapus Perusahaan",message:"Hapus pengguna dari daftar pelanggan node "+i.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(`${r}/${s}`).then(()=>{L(d=>typeof d=="string"&&d.startsWith(r)),n(),o.success("Berhasil menghapus subscription pengguna")}).catch(()=>{o.error("Gagal menghapus subscription pengguna")})})},m=()=>{a({title:"Hapus Semua Perusahaan",message:"Hapus semua perusahaan dari daftar pelanggan node "+i.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(`${r}`).then(()=>{L(s=>typeof s=="string"&&s.startsWith(r)),n(),o.success("Berhasil menghapus subscription pengguna")}).catch(()=>{o.error("Gagal menghapus subscription pengguna")})})},h=y.useMemo(()=>[B.accessor("name",{header:"Nama",cell:s=>{const{color:d,icon:x}=Me[s.row.original.type];return e.jsxs(c,{spacing:"3",children:[e.jsx(K,{rounded:"md",border:"2px solid",borderColor:d+".200",color:d+".500",p:"2",children:e.jsx($,{as:x,boxSize:"18px"})}),e.jsx(p,{children:s.getValue()})]})},meta:{sortable:!0}}),B.accessor("type",{header:"Jenis ",cell:s=>e.jsx(Qe,{value:s.getValue()}),meta:{sortable:!0}}),B.accessor("joinedAt",{header:"Berlangganan sejak",cell:s=>G(s.getValue()),meta:{sortable:!0}}),B.accessor("companyId",{header:"Aksi",cell:s=>e.jsxs(c,{children:[e.jsx(he,{size:"sm",colorScheme:"red",icon:e.jsx(N,{size:"16"}),"aria-label":"Hapus",onClick:()=>u(s.getValue())}),e.jsx(oe,{to:"/companies/"+s.getValue(),children:e.jsx(f,{colorScheme:"blue",size:"sm",leftIcon:e.jsx(ue,{size:"16"}),children:"Lihat Perusahaan"})})]})})],[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{IconEl:Te,children:["Daftar perusahaan yang mensubscribe",e.jsx(E,{colorScheme:"blue",ml:"2",children:t||0})]}),!!t&&e.jsxs(c,{mt:"4",children:[e.jsx(f,{colorScheme:"red",leftIcon:e.jsx(N,{size:"18"}),onClick:m,children:"Hapus Semua Perusahaan"}),e.jsx(ie,{}),e.jsx(le,{rounded:"md",bg:"white",placeholder:"Cari Perusahaan",_onSubmit:null})]}),e.jsx(ce,{mt:"4",apiUrl:r,columns:h,emptyMsg:["Belum ada Perusahaan"]})]})}function va({data:i,lastDataSent:n}){const l=[{key:"pm25",name:"PM2.5",unit:"µm/m3"},{key:"pm100",name:"PM10",unit:"µm/m3"},{key:"ch4",name:"Karbon dioksida",unit:"PPM"},{key:"co2",name:"Metana",unit:"PPM"}];return e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:Be,children:"Data terakhir dikirim"}),n?e.jsxs(e.Fragment,{children:[e.jsxs(c,{my:"3",children:[e.jsx(ya,{size:"20"}),e.jsx(p,{fontWeight:"600",children:"Data Terbaru"}),e.jsx(E,{children:me(n)})]}),e.jsx(pe,{gap:"2",children:l.map(({name:t,key:a,unit:r})=>e.jsxs(P,{flex:"1 0 0px",py:"2",px:"4",border:"2px solid",borderColor:"gray.200",rounded:"md",children:[e.jsx(p,{fontWeight:"600",children:t}),e.jsxs(c,{align:"baseline",children:[e.jsx(p,{fontWeight:"600",fontSize:"xl",children:i&&i[0][a]}),e.jsx(p,{fontSize:"sm",children:r})]})]},a))}),e.jsxs(c,{mb:"2",mt:"4",children:[e.jsx(Ca,{size:"20"}),e.jsx(p,{fontWeight:"600",children:"Tren 24 jam terakhir"})]}),e.jsxs(ea,{isLazy:!0,size:"sm",children:[e.jsx(na,{children:l.map(({name:t,key:a})=>e.jsx(ta,{children:t},a))}),e.jsx(aa,{children:l.map(({key:t})=>e.jsx(sa,{children:e.jsx(P,{w:"full",h:"280px",as:i?void 0:ze,children:!!i&&e.jsx(Ze,{data:i,simple:!0,dataKeyTypeAndFunc:{func:a=>({value:a[t]})}})})},t))})]})]}):e.jsx(K,{w:"full",py:"5",children:e.jsx(p,{fontWeight:"600",color:"gray.500",fontSize:"xl",children:"Node Belum Pernah Mengirim Data"})})]})}const z=de();function Da({data:i,mutate:n}){let{nodeId:l,countUserSubscription:t}=i;const a=re(),r=w(),o=`/nodes/${l}/users`,u=s=>{a({title:"Hapus Pengguna",message:"Hapus pengguna dari daftar pelanggan node "+i.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(`${o}/${s}`).then(()=>{L(d=>typeof d=="string"&&d.startsWith(o)),n(),r.success("Berhasil menghapus subscription pengguna")}).catch(()=>{r.error("Gagal menghapus subscription pengguna")})})},m=()=>{a({title:"Hapus Semua Pengguna",message:"Hapus Semua pengguna dari daftar pelanggan node "+i.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(`${o}`).then(()=>{L(s=>typeof s=="string"&&s.startsWith(o)),n(),r.success("Berhasil menghapus subscription pengguna")}).catch(()=>{r.error("Gagal menghapus subscription pengguna")})})},h=y.useMemo(()=>[z.accessor("name",{header:"Nama",cell:s=>e.jsx(Pe,{name:s.getValue()}),meta:{sortable:!0}}),z.accessor("phone",{header:"Telepon",cell:s=>e.jsx(oa,{href:"tel:+62"+s.getValue(),children:s.getValue()})}),z.accessor("joinedAt",{header:"Berlangganan sejak",cell:s=>G(s.getValue()),meta:{sortable:!0}}),z.accessor("userId",{header:"Aksi",cell:s=>e.jsxs(c,{children:[e.jsx(he,{size:"sm",colorScheme:"red",icon:e.jsx(N,{size:"16"}),"aria-label":"Hapus",onClick:()=>u(s.getValue())}),e.jsx(oe,{to:"/users/"+s.getValue(),children:e.jsx(f,{colorScheme:"blue",size:"sm",leftIcon:e.jsx(ue,{size:"16"}),children:"Lihat Pengguna"})})]})})],[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{IconEl:ra,children:["Daftar pengguna yang mensubscribe",e.jsx(E,{colorScheme:"blue",ml:"2",children:t||0})]}),!!t&&e.jsxs(c,{mt:"4",justify:"space-between",children:[e.jsx(f,{colorScheme:"red",leftIcon:e.jsx(N,{size:"18"}),onClick:m,children:"Hapus Semua Pengguna"}),e.jsx(ie,{}),e.jsx(le,{rounded:"md",bg:"white",placeholder:"Cari Pengguna",_onSubmit:null})]}),e.jsx(ce,{mt:"4",apiUrl:o,columns:h,emptyMsg:["Belum ada Pengguna"]})]})}function Ma({data:i,mutate:n,...l}){const{isOpen:t,onOpen:a,onClose:r}=Le(),o=w(),{name:u,description:m,address:h,instalationDate:s}=i,d={name:u,description:m,address:h,instalationDate:s},{id:x}=O(),ge=`${te}/nodes/${x}`,{handleChange:I,values:C,errors:g,setFieldError:je,handleSubmit:fe,handleBlur:k,resetForm:be,touched:v,isSubmitting:Se,setSubmitting:q}=da({initialValues:d,validationSchema:ma().shape({name:ia.required("Wajib diisi"),description:la.required("Wajib diisi"),address:ca.required("Wajib diisi"),instalationDate:ua().nullable()}),onSubmit:J=>{Xe(J);const A=Ye(d,J);if(Object.keys(A).length===0){o.opss("Belum ada yang disunting"),q(!1);return}S.patch(ge,{...A}).then(()=>{o.success("Berhasil Memperharui data"),n(b=>b&&{...b,...A}),r()}).catch(b=>{var X,Y;((X=b.response)==null?void 0:X.status)!==400&&o.error("Gagal Memperharui data");const[ye,Q]=((Y=b.response)==null?void 0:Y.data.message)||[];je(ye,Q),o.error(Q||"Ada yang salah")}).finally(()=>{q(!1)})}});return e.jsxs(e.Fragment,{children:[e.jsx(f,{onClick:a,...l}),e.jsxs(Ne,{size:"lg",autoFocus:!1,isOpen:t,onClose:r,closeOnOverlayClick:!1,children:[e.jsx(Fe,{}),e.jsx(Ee,{children:e.jsxs("form",{onSubmit:fe,className:"my-form",children:[e.jsx(we,{children:"Sunting Profil"}),e.jsx(Ae,{children:e.jsxs(ve,{mx:"auto",spacing:"2",maxW:"container.sm",children:[e.jsxs(D,{isInvalid:!!g.name&&v.name,children:[e.jsx(M,{children:"Nama"}),e.jsx(ae,{id:"name",name:"name",placeholder:"Misal : Suparna",onChange:I,onBlur:k,value:C.name}),e.jsx(T,{children:g.name})]}),e.jsxs(D,{isInvalid:!!g.description&&v.description,children:[e.jsx(M,{children:"Description"}),e.jsx(se,{id:"description",name:"description",placeholder:"Opsional",onChange:I,onBlur:k,value:C.description}),e.jsx(T,{children:g.description})]}),e.jsxs(D,{isInvalid:!!g.address&&v.address,children:[e.jsx(M,{children:"Alamat"}),e.jsx(se,{id:"address",name:"address",placeholder:"Opsional",onChange:I,onBlur:k,value:C.address}),e.jsx(T,{children:g.address})]}),e.jsxs(D,{isInvalid:!!g.instalationDate&&v.instalationDate,children:[e.jsx(M,{children:"Tanggal Instalasi"}),e.jsx(ae,{id:"instalationDate",name:"instalationDate",type:"date",onChange:I,onBlur:k,value:C.instalationDate}),e.jsx(T,{children:g.instalationDate})]})]})}),e.jsxs($e,{children:[e.jsx(f,{variant:"ghost",onClick:()=>{be(),r()},children:"Batal"}),e.jsx(f,{isLoading:Se,type:"submit",colorScheme:"blue",ml:3,children:"Submit"})]})]})})]})]})}function Ta({canEdit:i,data:n,mutate:l}){const[t,a]=y.useState(n.coordinate),[r,o]=y.useState(!1),[u,m]=y.useState(!1),{id:h}=O(),s=w(),d=async()=>{o(!0);const x=`${te}/nodes/${h}`;S.patch(x,{coordinate:t}).then(()=>{s.success("Lokasi Perusahaan berhasil diperbarui"),l({...n,coordinate:t})}).catch(()=>{s.error("Lokasi Perusahaan gagal diperbarui")}).finally(()=>{m(!1),o(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:Ia,children:"Letak Node"}),e.jsx(qe,{canEdit:i,coordinate:n.coordinate,isEditingState:[u,m],editedCoordinateState:[t,a],isSubmiting:r,handleSubmitEditedCoordinate:d}),e.jsx(ha,{mt:"4",data:[n],outline:u?"3px solid":"",outlineColor:"orange.300",isEditing:u?{coordinate:t||n.coordinate,onChange:x=>a([x.lat,x.lng])}:void 0})]})}function ss(){var d,x;const{id:i}=O(),{roleIs:n,user:l}=He(),t=`/nodes/${i}`,{data:a,mutate:r,error:o}=We(t,Ue);if(o)throw o;if(!a)return e.jsx(Ve,{});const u=!!a.owner,m=_e[a.isUptodate?"active":"nonactive"],h=Re[a.companyId?"private":"public"],s=n("admin")||n("manager")&&((d=a.owner)==null?void 0:d.managedBy)==l.userId;return e.jsxs(P,{children:[e.jsx(c,{w:"full",spacing:"4",align:"start",children:e.jsxs(c,{spacing:"3",children:[e.jsx(K,{boxSize:"30px",boxShadow:"xs",bg:"gray.100",rounded:"md",p:"1",children:e.jsx(Oe,{})}),e.jsx(Z,{fontSize:"xl",fontWeight:"600",children:"Detail Node"})]})}),e.jsxs(De,{mt:"8",maxW:"container.md",children:[e.jsxs(c,{spacing:"4",justify:"space-between",children:[e.jsxs(P,{children:[e.jsx(Z,{fontSize:"3xl",children:a.name}),e.jsx(c,{mt:"2",children:!!a.instalationDate&&e.jsx(Ke,{icon:ja,colorScheme:"orange",children:`Node dipasang pada ${G(a.instalationDate)}`})}),a.owner&&e.jsx(Je,{mt:"3",data:a.owner})]}),s&&e.jsx(Ma,{data:a,mutate:r,colorScheme:"blue",alignSelf:"start",leftIcon:e.jsx(fa,{size:"16"}),children:"Sunting Profil"})]}),e.jsx(j,{IconEl:pa,children:"Deskripsi Node"}),e.jsx(p,{children:a.description}),!u&&e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:xa,children:"Alamat"}),e.jsx(p,{children:a.address})]}),e.jsx(j,{IconEl:Sa,children:"Status"}),e.jsxs(pe,{mt:"3",gap:"4",flexWrap:"wrap",children:[e.jsxs(H,{flex:"1 0 100px",bg:m.color+".50",p:"4",rounded:"md",border:"2px solid",borderColor:m.color+".400",children:[e.jsx(W,{children:"Status"}),e.jsxs(c,{spacing:"2",my:"1",children:[e.jsx($,{as:m.icon,boxSize:"28px"}),e.jsx(U,{textTransform:"capitalize",children:m.name})]}),e.jsxs(c,{children:[e.jsx(ne,{size:"16"}),e.jsx(p,{fontSize:"sm",children:m.note})]}),e.jsx(ee,{borderColor:m.color,mt:"3",mb:"2"}),e.jsxs(p,{fontSize:"sm",children:["Terakhir data diperbarui"," ",me(a.lastDataSent)]})]}),e.jsxs(H,{flex:"1 0 100px",bg:h.color+".50",p:"4",rounded:"md",border:"2px solid",borderColor:h.color+".400",children:[e.jsx(W,{children:"Kepemilikan"}),e.jsxs(c,{spacing:"2",my:"1",children:[e.jsx($,{as:h.icon,boxSize:"28px"}),e.jsx(U,{textTransform:"capitalize",children:h.name})]}),e.jsxs(c,{children:[e.jsx(ne,{size:"16"}),e.jsx(p,{fontSize:"sm",children:h.note})]}),e.jsx(ee,{borderColor:h.color,mt:"3",mb:"2"}),e.jsxs(c,{fontSize:"sm",align:"baseline",children:[e.jsx(p,{children:"Dikelola oleh: "}),e.jsx(E,{size:"sm",fontSize:"xs",children:((x=a.owner)==null?void 0:x.name)||"Admin"})]})]})]}),!u&&e.jsx(Ta,{canEdit:s,data:a,mutate:r}),!a.companyId&&n("admin")&&e.jsxs(e.Fragment,{children:[e.jsx(ka,{data:a,mutate:r}),e.jsx(Da,{data:a,mutate:r})]}),e.jsx(va,{data:a.dataLogs,lastDataSent:a.lastDataSent,mutate:r}),s&&e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:Ge,children:"Lainnya"}),e.jsx(ga,{resource:"Node",name:a.name,colorScheme:"red",deleteApiUrl:"/nodes/"+a.nodeId,redirectPath:"/nodes"})]})]})]})}export{ss as default};
