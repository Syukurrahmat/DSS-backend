import{r as k,j as a,a0 as y,W as Q,Y as d,F as W,I as D,U as w,V as X}from"./font-Qhbu9OiB.js";import{B as M}from"./BigAlert-YoC157VC.js";import{u as Z,r as aa,p as ea,a1 as sa,m as ia,C as na,J as ta,a2 as oa,w as ra}from"./app-OFdP0MLv.js";import{F as da}from"./FormMapPicker-GvUMcZfJ.js";import{R as g}from"./RequiredIndicator-HartruzP.js";import{S as la}from"./Sdd-CWXvFdIT.js";import{u as ca,a as ma}from"./common.utils-KfV-hsLd.js";import{n as V,d as E,b as pa}from"./validator.utils-BbPBxsiX.js";import{u as ua,F as l,b,c as $,f as z,e as ha,d as xa}from"./index.esm-BrGPXCIo.js";import{I as ja}from"./IconInfoCircle-qk8dWh0h.js";import{T as ga,a as ba,b as fa}from"./chunk-4YMKQ5D4-BNLh7UBr.js";import{T as Ia,a as Na}from"./chunk-IAXSQ4X2-BJSR8lPV.js";import{D as ka}from"./logo-C54eNvEo.js";import{F as c,c as q,B as ya}from"./logo-white-Cvs5dC_u.js";import{T as L}from"./chunk-4IH3O7BJ-B7oiDjaY.js";import"./IconCirclePlus-D17UvEMI.js";import"./index-ClY7xd3L.js";import"./dateFormating-k4McqWkx.js";import"./TagWithIcon-CCVojo9e.js";const Sa=$().shape({name:V.required("Wajib diisi"),description:E.required("Wajib diisi"),address:pa.required("Wajib diisi"),instalationDate:z().nullable(),coordinate:ha().test("","Anda Belum menentukan titik koordinat",m=>m&&m.filter(f=>f).length==2)}),va=$().shape({companyId:xa().required("Wajib diisi"),name:V.required("Wajib diisi"),description:E.required("Wajib diisi"),instalationDate:z().nullable()});function Oa(){var T;const{roleIs:m}=Z(),f=aa(),R=ca(),S=!ea("/nodes/create"),v=!S&&m("admin"),[o,U]=k.useState(v?0:1),[H,I]=k.useState(),e=(T=f.state)==null?void 0:T.company;if(S&&!e)return a.jsx(sa,{to:"..",relative:"path"});const O=o?va:Sa,{handleChange:p,handleBlur:u,values:_,touched:h,status:r,setStatus:B,setFieldValue:N,setFieldError:J,resetForm:C,setSubmitting:Y,isSubmitting:G,errors:i,handleSubmit:K}=ua({initialValues:{name:"",description:"",address:"",instalationDate:"",coordinate:[NaN,NaN],companyId:(e==null?void 0:e.companyId)||NaN},validationSchema:O,onSubmit:s=>{let t={};if(o){const{coordinate:n,address:x,...j}=s;t=j}else{const{companyId:n,...x}=s;t=x}ia.post("/nodes",ma(t)).then(({data:n})=>{B({created:!0,nodeId:n.data.nodeId})}).catch(n=>{var A,P;if(((A=n.response)==null?void 0:A.status)!==400)return B({created:!1});const[x,j]=((P=n.response)==null?void 0:P.data.message)||[];J(x,j),R.error(j||"Ada yang salah")}).finally(()=>Y(!1))}});k.useEffect(()=>{N("companyId",(e==null?void 0:e.companyId)||NaN)},[]);const F=[{icon:oa,name:"Node Publik",note:"Membuat node Publik yang dapat digunakan oeh semua user"},{icon:ra,name:"Node Private",note:"Membuat node private hanya suatu perusahaan spesifik"}];return a.jsxs(y,{children:[a.jsx(Q,{size:"lg",children:"Buat Node"}),a.jsx(d,{color:"dimmed",children:"Buat node untuk menambah akurasi sistem"}),a.jsxs(W,{maxW:"container.md",mt:"4",px:"0",children:[r===void 0&&v&&a.jsxs(ga,{index:o,onChange:U,variant:"soft-rounded",colorScheme:"blue",children:[a.jsx(Ia,{gap:"4",children:F.map(({name:s,icon:t},n)=>a.jsxs(Na,{rounded:"md",children:[a.jsx(D,{as:t,boxSize:"20px"}),a.jsx(d,{ml:"2",children:s})]},n))}),a.jsx(ka,{mt:"2",border:"1px solid",borderColor:"gray.400"}),a.jsx(ba,{children:F.map(({note:s},t)=>a.jsxs(fa,{px:"0",as:w,align:"start",spacing:"1",children:[a.jsx(D,{as:ja,boxSize:"20px",mt:"2px"}),a.jsx(d,{ml:"2",children:s})]},t))})]}),r===void 0?a.jsx(W,{maxW:"container.sm",px:"0",children:a.jsx("form",{onSubmit:K,className:"my-form",children:a.jsxs(X,{mx:"auto",spacing:"2",maxW:"container.sm",children:[o&&(e?a.jsxs(y,{alignSelf:"start",children:[a.jsx(d,{fontWeight:"600",children:"Buat Node Untuk Perusahaan"}),a.jsxs(w,{mt:"2",spacing:"3",shadow:"xs",p:"3",bg:"white",rounded:"md",children:[a.jsx(na,{type:e.type,size:"24px"}),a.jsxs(y,{children:[a.jsx(d,{fontWeight:"600",pr:"2",children:e.name}),a.jsx(d,{children:ta[e.type].name})]})]})]}):a.jsxs(c,{children:[a.jsxs(l,{children:["Pilih Perusahaan ",a.jsx(g,{})]}),a.jsx(la,{_value:H,_onChange:s=>{I(s),N("companyId",s==null?void 0:s.companyId)}}),a.jsx(b,{children:i.companyId})]})),a.jsxs(c,{isInvalid:!!i.name&&h.name,children:[a.jsxs(l,{children:["Nama Node ",a.jsx(g,{})]}),a.jsx(q,{id:"name",name:"name",placeholder:"Misal : Belakang rumah pak Subegja",onChange:p,onBlur:u}),a.jsx(b,{children:i.name})]}),a.jsxs(c,{isInvalid:!!i.description&&h.description,children:[a.jsxs(l,{children:["Deskripsi node ",a.jsx(g,{})]}),a.jsx(L,{id:"description",name:"description",placeholder:"Masukkan deskripsi node, singkat saja",onChange:p,onBlur:u}),a.jsx(b,{children:i.description})]}),!o&&a.jsx(a.Fragment,{children:a.jsxs(c,{isInvalid:!!i.address&&h.address,children:[a.jsxs(l,{children:["Alamat node ",a.jsx(g,{})]}),a.jsx(L,{id:"address",name:"address",placeholder:"Masukkan Alamat Node berada",onChange:p,onBlur:u}),a.jsx(b,{children:i.address})]})}),a.jsxs(c,{children:[a.jsx(l,{children:"Tanggal Instalasi"}),a.jsx(q,{w:"fit-content",type:"date",id:"instalationDate",name:"instalationDate",onChange:p,onBlur:u})]}),!o&&a.jsx(da,{errors:i.coordinate,touched:h.coordinate,values:_.coordinate,setFieldValue:N}),a.jsx(ya,{isLoading:G,w:"full",mt:"4",colorScheme:"green",type:"submit",children:"Buat Node"})]})})}):r.created?a.jsx(M,{status:"success",title:"Node berhasil dibuat",description:"Node siap untuk digunakan dalam sistem Anda",onCreateAgain:()=>{C(),I(void 0)},itemName:"node",detailPageURL:`/nodes/${r==null?void 0:r.nodeId}`}):a.jsx(M,{status:"warning",title:"Node gagal didaftarkan",description:"Ada yang salah. Hubungi Administrator",onCreateAgain:()=>{C(),I(void 0)}})]})]})}export{Oa as default};
