import{H as E,j as e,T as b,r as y,X as W,K as M,I as _,a0 as $,V as I,L as V,N as q,a1 as K,a2 as Q,a3 as J}from"./createReactComponent-BjMSnX4u.js";import{M as z,a as X}from"./index-CmYfqyqM.js";import{S as Z,C as ee,a as ae,u as T,b as H,f as U,R as se,c as re,d as B,m as te,e as oe,A as ne,M as ie,g as le,h as ce,i as de,j as ue,k as me,I as he,l as F,n as pe,U as xe}from"./app-Dlg_0vKY.js";import{C as ge}from"./chunk-RKXMPHPI-BW5nJw41.js";import{c as x,B as R,e as G,F as k,h as je,C as fe,I as A}from"./axios-DSJo49NX.js";import{H as g,C as O}from"./icon-CgCgY_AD.js";import{S as L}from"./chunk-VTV6N5LE-DsJG0bJy.js";import{F as D}from"./chunk-KRPLQIP4-CDbFQY1-.js";import{R as w}from"./RequiredIndicator-vpk6RQqX.js";import{R as N,I as ye,a as be}from"./ReportCard-CQq-mUEi.js";import{T as Ce}from"./dateFormating-BW4zoMdD.js";import{u as ke,t as ve,a as Y}from"./common.utils-T8z9TsUm.js";import{u as Se,F as v,b as S,c as we,a as Me,d as Ie,e as Be}from"./index.esm-C4YBZUZR.js";import{M as Fe}from"./chunk-4FCEGNGT-Dke9LU8Y.js";import{T as Re}from"./chunk-4IH3O7BJ-s8F57N1M.js";import"./index.tags-CTXl78sl.js";import"./TagWithIcon-BjtYG5-s.js";import"./IconMapPin-Cm_Rdr-X.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Te=E("outline","camera-plus","IconCameraPlus",[["path",{d:"M12 20h-7a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}],["path",{d:"M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var De=E("outline","mood-neutral","IconMoodNeutral",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 10l.01 0",key:"svg-1"}],["path",{d:"M15 10l.01 0",key:"svg-2"}]]);const Pe=[{distance:250,label:"250 m"},{distance:500,label:"500 m"},{distance:1e3,label:"1 km"},{distance:2500,label:"2,5 km"}];function Ae({isOpen:a,filterState:o,apiUrl:d}){const[t,r]=o;return e.jsx(x,{w:"full",children:e.jsx(ge,{in:a,animateOpacity:!0,children:e.jsxs(g,{spacing:"3",mt:"4",children:[e.jsxs(x,{as:"label",flexGrow:"1",children:[e.jsx(b,{mb:"1",children:"Perusahaan"}),e.jsx(Z,{w:"200px",fontWeight:"400",itemName:"Perusahaan",hiddenTitleButton:!0,apiUrl:d,_value:t.company,_onChange:s=>r(n=>({...n,company:s})),borderColor:"gray.200",color:"gray.700",displayRow:s=>e.jsxs(g,{children:[e.jsx(ee,{bg:"white",type:s.type}),e.jsx(b,{children:(s==null?void 0:s.name)||"Node yang Anda ikuti"})]})})]}),e.jsxs(x,{as:"label",flexGrow:"1",children:[e.jsx(b,{mb:"1",children:"Jarak"}),e.jsx(ae,{value:t.distance,onChange:s=>{r(n=>({...n,distance:parseInt(s.target.value)}))},children:Pe.map(s=>e.jsx("option",{value:s.distance,children:s.label},s.distance))})]})]})})})}function Oe({filterState:a,filterDisclosure:o,showCompaniesState:d,showCompaniesDisclosure:t}){const{user:r,roleIs:s}=T(),{isOpen:n,onToggle:i,onClose:p}=o,{isOpen:m,onToggle:C,onClose:c}=t,h=s(["admin","gov"])?"/companies?all=true&view=simple":`/users/${r.userId}/companies?all=true&view=simple`,{data:l}=H(t.isOpen?h:null,U);return y.useEffect(()=>{d[1]((l==null?void 0:l.rows)||[])},[l]),e.jsxs(x,{w:"full",children:[e.jsxs(g,{w:"full",justify:"space-between",children:[e.jsxs(D,{align:"center",children:[e.jsx(b,{fontWeight:"500",alignSelf:"start",children:"Tampilkan Lokasi Perusahaan"}),m&&!l&&e.jsx(W,{size:"sm",ml:"2",color:"gray.500"})]}),e.jsx(L,{onChange:j=>{j.target.checked&&p(),C()},isChecked:m})]}),e.jsxs(g,{w:"full",justify:"space-between",mt:"4",children:[e.jsx(b,{fontWeight:"500",alignSelf:"start",children:"Filter aduan di sekitar perusahaan Anda"}),e.jsx(L,{onChange:j=>{j.target.checked&&c(),i()},isChecked:n})]}),e.jsx(Ae,{isOpen:n,apiUrl:h,filterState:a})]})}function Le({rating:a,setRating:o}){const[d,t]=y.useState(0),r=d||a;let s=["Buruk sekali","Buruk","Biasa aja","Bagus","Bagus sekali"];return e.jsxs(g,{mx:"auto",w:"fit-content",children:[e.jsx(O,{border:"1px solid",borderColor:"gray.300",rounded:"lg",p:"2",children:e.jsx(M,{as:r?N[r-1].icon:De,color:r?N[r-1].color:"gray.400",boxSize:"50px"})}),e.jsxs(x,{children:[e.jsx(Ce,{children:r?s[r-1]:"Pilih Berapa Bintang"}),e.jsx(se,{onChange:n=>o(Number(n)),value:a.toString(),children:e.jsx(g,{spacing:"0",children:[...Array(5)].map((n,i)=>e.jsxs(O,{as:"label",p:"2",onMouseEnter:()=>t(i+1),onMouseLeave:()=>t(0),cursor:"pointer",children:[e.jsx(re,{display:"none",value:(i+1).toString()},i),e.jsx(M,{as:ye,boxSize:"25px",color:i+1<=(d||a)?"yellow.400":"gray.300"})]},i))})})]})]})}function Ne({values:a,onChange:o,...d}){const t=a.filter(r=>r);return e.jsxs(x,{...d,children:[e.jsx(D,{gap:"3",flexWrap:"wrap",children:a.map((r,s)=>e.jsxs(x,{position:"relative",flexGrow:"1",flexShrink:"0",w:"100px",h:"100px",children:[e.jsxs(R,{p:"0",w:"full",h:"full",as:"label",variant:"outline",overflow:"hidden",cursor:"pointer",children:[r?e.jsx(_,{objectFit:"cover",src:URL.createObjectURL(r)}):e.jsx(M,{as:Te,boxSize:"30px",color:"gray.400"}),e.jsx(G,{type:"file",accept:"image/*",display:"none",onChange:n=>{o((()=>{let i=[...a];return n.target.files&&(i[s]=n.target.files[0]),i})())}})]}),r&&e.jsx($,{size:"sm",onClick:()=>{o((()=>{let n=[...a];return n[s]=null,n})())},bg:"gray.300",position:"absolute",top:"10px",right:"10px"})]},s))}),e.jsx(b,{mt:"2",fontSize:"sm",children:t.length?t.length+" Foto ditambahkan":"Belum ada foto yang ditambahkan"})]})}const Ye=we().shape({message:Me().max(255,"Terlalu Panjang").required("Wajib Diisi"),rating:Ie().required("Wajib Diisi"),coordinate:Be().test("","Anda Belum menentukan titik koordinat",a=>a&&a.filter(o=>o).length==2)});function Ee(){const{user:a}=T(),{isOpen:o,onOpen:d,onClose:t}=B(),r=ke(),{handleChange:s,handleBlur:n,isSubmitting:i,values:p,setFieldValue:m,setSubmitting:C,resetForm:c,touched:h,errors:l,handleSubmit:j}=Se({initialValues:{message:"",rating:0,coordinate:[NaN,NaN],images:[null,null,null]},validationSchema:Ye,onSubmit:async u=>{const P=await Promise.all(u.images.filter(f=>f).map(f=>ve(f)));console.log(Y({...u,images:P})),te.post("/reports",Y({...u,images:P})).then(()=>{r.success("Aduan berhasil dikirim"),oe(f=>typeof f=="string"&&f.startsWith("/reports"),null,{revalidate:!0})}).catch(()=>r.success("Ada yang salah, aduan gagal dikirim")).finally(()=>{t(),C(!1),c()})}});return e.jsxs(e.Fragment,{children:[e.jsxs(g,{rounded:"md",bg:"white",w:"full",color:"gray.500",justifyContent:"start",cursor:"pointer",onClick:d,children:[e.jsx(ne,{boxSize:"37px",name:a.name,src:a.profilePicture}),e.jsx(x,{fontWeight:"400",border:"1px solid",borderColor:"gray.300",px:"4",py:"2",w:"full",rounded:"full",children:"Buat Aduan"})]}),e.jsx(ie,{size:"2xl",isOpen:o,onClose:t,scrollBehavior:"inside",closeOnEsc:!1,children:e.jsxs("form",{onSubmit:j,children:[e.jsx(le,{}),e.jsxs(ce,{children:[e.jsx(de,{borderBottom:"1px solid",borderColor:"gray.200",children:"Posting Aduan"}),e.jsx(Fe,{}),e.jsx(ue,{children:e.jsxs(I,{mx:"auto",spacing:"2",maxW:"container.sm",mt:"4",children:[e.jsxs(k,{isInvalid:!!l.message&&h.message,children:[e.jsxs(v,{children:["Tuis Pesan ",e.jsx(w,{})]}),e.jsx(Re,{id:"message",name:"message",placeholder:"Tulis kuaitas udara yang anda rasakan saat ini",onChange:s,onBlur:n}),e.jsx(S,{children:l.message})]}),e.jsxs(k,{isInvalid:!!l.rating&&h.rating,children:[e.jsxs(v,{children:["Pilih Bintang ",e.jsx(w,{})]}),e.jsx(Le,{rating:p.rating,setRating:u=>m("rating",u),size:2}),e.jsx(S,{children:l.rating})]}),e.jsxs(k,{isInvalid:!!l.coordinate&&h.coordinate,children:[e.jsxs(v,{children:["Lokasi ",e.jsx(w,{})]}),e.jsx(je,{children:"Geser peta dan paskan penanda ke titik yang dimaksud"}),e.jsx(z,{scrollWheelZoom:!1,mt:"3",data:[],outline:l.coordinate&&h.coordinate?"2px solid":"",outlineColor:"#E53E3E",isEditing:{coordinate:p.coordinate.filter(u=>u).length?p.coordinate:fe,onChange:u=>m("coordinate",[u.lat,u.lng])}}),e.jsx(S,{children:l.coordinate})]}),e.jsxs(k,{isInvalid:!!l.images&&h.images,children:[e.jsx(v,{children:"Foto"}),e.jsx(Ne,{values:p.images,onChange:u=>m("images",u)}),e.jsx(S,{children:l.images})]})]})}),e.jsxs(me,{borderTop:"1px solid",borderColor:"gray.200",children:[e.jsx(R,{onClick:()=>{c(),t()},children:"Batal"}),e.jsx(R,{colorScheme:"blue",ml:3,type:"submit",isLoading:i,children:"Kirim"})]})]})]})})]})}function We({pagination:a,dateState:o}){const[d,t]=o,r=a==null?void 0:a.next,s=a==null?void 0:a.previous,n=a==null?void 0:a.current;return e.jsxs(g,{justify:"space-between",w:"full",children:[e.jsx(A,{variant:"outline",icon:e.jsx(he,{}),"aria-label":"previous",isDisabled:!s,onClick:()=>s?t(s):null}),e.jsx(G,{variant:"outline",onFocus:i=>i.target.showPicker(),type:"date",textAlign:"center",max:F().format("YYYY-MM-DD"),onChange:i=>t(i.target.value),value:n||d}),e.jsx(A,{variant:"outline",icon:e.jsx(pe,{}),"aria-label":"next",isDisabled:!r,onClick:()=>r?t(r):null})]})}const ze=(a,o)=>!o.company||!a?{}:{nearCompany:o.company.companyId,distance:o.distance};function na(){const{roleIsNot:a}=T(),o=B(),d=B(),[t,r]=y.useState({distance:250}),[s,n]=y.useState([]),i=F().format("YYYY-MM-DD"),p=y.useRef(),[m,C]=y.useState(i),{data:c,isLoading:h}=H(xe("/reports",{date:m,...ze(o.isOpen,t)}),U);return e.jsxs(D,{maxH:"100%",direction:"row",justify:"space-between",alignItems:"stretch",gap:"4",children:[e.jsx(x,{flex:"3 1 0",mb:"auto",position:"relative",h:"100%",overflowY:"auto",className:"custom-scrollbar",children:e.jsxs(I,{position:"absolute",pr:"3",w:"full",spacing:"3",children:[e.jsx(V,{w:"full",children:e.jsx(q,{children:e.jsxs(I,{spacing:"4",children:[e.jsx(Ee,{}),e.jsx(We,{pagination:c==null?void 0:c.pagination,dateState:[m,C]}),a("regular")&&e.jsx(Oe,{filterState:[t,r],filterDisclosure:o,showCompaniesState:[s,n],showCompaniesDisclosure:d})]})})}),e.jsxs(K,{boxShadow:"sm",fontSize:"md",rounded:"md",variant:"left-accent",children:[h?e.jsx(W,{thickness:"2px",colorScheme:"blue",boxSize:"20px",mr:"3"}):e.jsx(Q,{}),e.jsx(J,{children:h?"Mengambil Data...":((c==null?void 0:c.result.length)||"Tidak ada")+(m===i?" aduan di 24 jam terakhir":" aduan pada tanggal "+F(m).format("DD MMM YYYY"))})]}),c==null?void 0:c.result.map((l,j)=>e.jsx(be,{data:l,map:p.current},j))]})}),e.jsx(z,{flex:"5 1 0",h:"auto",marker:X.RatingMarker,companiesData:d.isOpen?s:o.isOpen&&t.company?[t.company]:[],circleBoundaryRadius:o.isOpen?t.distance:void 0,data:(c==null?void 0:c.result.map(l=>({isReport:!0,...l})))||[],mapRef:p})]})}export{na as default};
