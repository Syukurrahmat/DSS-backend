import{K as N,j as e,L as x,T as b,r as y,a0 as Y,N as M,I as G,a4 as _,V as I,a5 as $,Q as V,U as q,a6 as Q,a7 as K,a8 as J}from"./createReactComponent-WPW12zrK.js";import{M as E,a as Z}from"./index-_9iesu2c.js";import{S as X,C as ee,a as ae,u as T,b as W,f as z,R as se,c as re,d as B,m as te,e as ne,A as oe,M as ie,g as le,h as ce,i as de,j as ue,k as me,I as he,l as F,n as pe,U as xe}from"./app-BIM-v5sX.js";import{C as ge}from"./chunk-RKXMPHPI-B5CDTrjb.js";import{H as g,C as P}from"./icon-BvDSS9q3.js";import{S as A}from"./chunk-VTV6N5LE-THMhlwjU.js";import{F as D}from"./chunk-KRPLQIP4-BfVHV2g3.js";import{R as w}from"./RequiredIndicator-BSTyY86i.js";import{R as O,I as je,a as fe}from"./ReportCard-CIzhWrjx.js";import{T as ye}from"./dateFormating-_VgpDya0.js";import{u as be,t as Ce,a as ke}from"./common.utils-BDtzQ6xa.js";import{u as ve,F as k,b as v,c as Se,a as we,d as Me,e as Ie}from"./index.esm-BStM4cIJ.js";import{B as R,c as U,F as S,f as Be,I as L}from"./icon-white-BiuxQ1Ek.js";import{M as Fe}from"./chunk-4FCEGNGT-CiI93Czq.js";import{T as Re}from"./chunk-4IH3O7BJ-s5k9DqCt.js";import"./index.tags-0kB2MkZx.js";import"./TagWithIcon-DFTk4qIc.js";import"./IconMapPin-BfSd31x9.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Te=N("outline","camera-plus","IconCameraPlus",[["path",{d:"M12 20h-7a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}],["path",{d:"M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var De=N("outline","mood-neutral","IconMoodNeutral",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 10l.01 0",key:"svg-1"}],["path",{d:"M15 10l.01 0",key:"svg-2"}]]);const Pe=[{distance:250,label:"250 m"},{distance:500,label:"500 m"},{distance:1e3,label:"1 km"},{distance:2500,label:"2,5 km"}];function Ae({isOpen:a,filterState:n,apiUrl:d}){const[t,r]=n;return e.jsx(x,{w:"full",children:e.jsx(ge,{in:a,animateOpacity:!0,children:e.jsxs(g,{spacing:"3",mt:"4",children:[e.jsxs(x,{as:"label",flexGrow:"1",children:[e.jsx(b,{mb:"1",children:"Perusahaan"}),e.jsx(X,{w:"200px",fontWeight:"400",itemName:"Perusahaan",hiddenTitleButton:!0,apiUrl:d,_value:t.company,_onChange:s=>r(o=>({...o,company:s})),borderColor:"gray.200",color:"gray.700",displayRow:s=>e.jsxs(g,{children:[e.jsx(ee,{bg:"white",type:s.type}),e.jsx(b,{children:(s==null?void 0:s.name)||"Node yang Anda ikuti"})]})})]}),e.jsxs(x,{as:"label",flexGrow:"1",children:[e.jsx(b,{mb:"1",children:"Jarak"}),e.jsx(ae,{value:t.distance,onChange:s=>{r(o=>({...o,distance:parseInt(s.target.value)}))},children:Pe.map(s=>e.jsx("option",{value:s.distance,children:s.label},s.distance))})]})]})})})}function Oe({filterState:a,filterDisclosure:n,showCompaniesState:d,showCompaniesDisclosure:t}){const{user:r,roleIs:s}=T(),{isOpen:o,onToggle:i,onClose:p}=n,{isOpen:u,onToggle:C,onClose:c}=t,m=s(["admin","gov"])?"/companies?all=true&view=simple":`/users/${r.userId}/companies?all=true&view=simple`,{data:l}=W(t.isOpen?m:null,z);return y.useEffect(()=>{d[1]((l==null?void 0:l.rows)||[])},[l]),e.jsxs(x,{w:"full",children:[e.jsxs(g,{w:"full",justify:"space-between",children:[e.jsxs(D,{align:"center",children:[e.jsx(b,{fontWeight:"500",alignSelf:"start",children:"Tampilkan Lokasi Perusahaan"}),u&&!l&&e.jsx(Y,{size:"sm",ml:"2",color:"gray.500"})]}),e.jsx(A,{onChange:j=>{j.target.checked&&p(),C()},isChecked:u})]}),e.jsxs(g,{w:"full",justify:"space-between",mt:"4",children:[e.jsx(b,{fontWeight:"500",alignSelf:"start",children:"Filter aduan di sekitar perusahaan Anda"}),e.jsx(A,{onChange:j=>{j.target.checked&&c(),i()},isChecked:o})]}),e.jsx(Ae,{isOpen:o,apiUrl:m,filterState:a})]})}function Le({rating:a,setRating:n}){const[d,t]=y.useState(0),r=d||a;let s=["Buruk sekali","Buruk","Biasa aja","Bagus","Bagus sekali"];return e.jsxs(g,{mx:"auto",w:"fit-content",children:[e.jsx(P,{border:"1px solid",borderColor:"gray.300",rounded:"lg",p:"2",children:e.jsx(M,{as:r?O[r-1].icon:De,color:r?O[r-1].color:"gray.400",boxSize:"50px"})}),e.jsxs(x,{children:[e.jsx(ye,{children:r?s[r-1]:"Pilih Berapa Bintang"}),e.jsx(se,{onChange:o=>n(Number(o)),value:a.toString(),children:e.jsx(g,{spacing:"0",children:[...Array(5)].map((o,i)=>e.jsxs(P,{as:"label",p:"2",onMouseEnter:()=>t(i+1),onMouseLeave:()=>t(0),cursor:"pointer",children:[e.jsx(re,{display:"none",value:(i+1).toString()},i),e.jsx(M,{as:je,boxSize:"25px",color:i+1<=(d||a)?"yellow.400":"gray.300"})]},i))})})]})]})}function Ne({values:a,onChange:n,...d}){const t=a.filter(r=>r);return e.jsxs(x,{...d,children:[e.jsx(D,{gap:"3",flexWrap:"wrap",children:a.map((r,s)=>e.jsxs(x,{position:"relative",flexGrow:"1",flexShrink:"0",w:"100px",h:"100px",children:[e.jsxs(R,{p:"0",w:"full",h:"full",as:"label",variant:"outline",overflow:"hidden",cursor:"pointer",children:[r?e.jsx(G,{objectFit:"cover",src:URL.createObjectURL(r)}):e.jsx(M,{as:Te,boxSize:"30px",color:"gray.400"}),e.jsx(U,{type:"file",accept:"image/*",display:"none",onChange:o=>{n((()=>{let i=[...a];return o.target.files&&(i[s]=o.target.files[0]),i})())}})]}),r&&e.jsx(_,{size:"sm",onClick:()=>{n((()=>{let o=[...a];return o[s]=null,o})())},bg:"gray.300",position:"absolute",top:"10px",right:"10px"})]},s))}),e.jsx(b,{mt:"2",fontSize:"sm",children:t.length?t.length+" Foto ditambahkan":"Belum ada foto yang ditambahkan"})]})}const Ye=Se().shape({message:we().max(255,"Terlalu Panjang").required("Wajib Diisi"),rating:Me().required("Wajib Diisi"),coordinate:Ie().test("","Anda Belum menentukan titik koordinat",a=>a&&a.filter(n=>n).length==2)});function Ee(){const{user:a}=T(),{isOpen:n,onOpen:d,onClose:t}=B(),r=be(),{handleChange:s,handleBlur:o,isSubmitting:i,values:p,setFieldValue:u,setSubmitting:C,resetForm:c,touched:m,errors:l,handleSubmit:j}=ve({initialValues:{message:"",rating:0,coordinate:[NaN,NaN],images:[null,null,null]},validationSchema:Ye,onSubmit:async h=>{const H=await Promise.all(h.images.filter(f=>f).map(f=>Ce(f)));te.post("/reports",ke({...h,images:H})).then(()=>{r.success("Aduan berhasil dikirim"),ne(f=>typeof f=="string"&&f.startsWith("/reports"),null,{revalidate:!0})}).catch(()=>r.success("Ada yang salah, aduan gagal dikirim")).finally(()=>{t(),C(!1),c()})}});return e.jsxs(e.Fragment,{children:[e.jsxs(g,{rounded:"md",bg:"white",w:"full",color:"gray.500",justifyContent:"start",cursor:"pointer",onClick:d,children:[e.jsx(oe,{boxSize:"37px",name:a.name,src:a.profilePicture}),e.jsx(x,{fontWeight:"400",border:"1px solid",borderColor:"gray.300",px:"4",py:"2",w:"full",rounded:"full",children:"Buat Aduan"})]}),e.jsx(ie,{size:"2xl",isOpen:n,onClose:t,scrollBehavior:"inside",closeOnEsc:!1,children:e.jsxs("form",{onSubmit:j,children:[e.jsx(le,{}),e.jsxs(ce,{children:[e.jsx(de,{borderBottom:"1px solid",borderColor:"gray.200",children:"Posting Aduan"}),e.jsx(Fe,{}),e.jsx(ue,{children:e.jsxs(I,{mx:"auto",spacing:"2",maxW:"container.sm",mt:"4",children:[e.jsxs(S,{isInvalid:!!l.message&&m.message,children:[e.jsxs(k,{children:["Tuis Pesan ",e.jsx(w,{})]}),e.jsx(Re,{id:"message",name:"message",placeholder:"Tulis kuaitas udara yang anda rasakan saat ini",onChange:s,onBlur:o}),e.jsx(v,{children:l.message})]}),e.jsxs(S,{isInvalid:!!l.rating&&m.rating,children:[e.jsxs(k,{children:["Pilih Bintang ",e.jsx(w,{})]}),e.jsx(Le,{rating:p.rating,setRating:h=>u("rating",h),size:2}),e.jsx(v,{children:l.rating})]}),e.jsxs(S,{isInvalid:!!l.coordinate&&m.coordinate,children:[e.jsxs(k,{children:["Lokasi ",e.jsx(w,{})]}),e.jsx(Be,{children:"Geser peta dan paskan penanda ke titik yang dimaksud"}),e.jsx(E,{scrollWheelZoom:!1,mt:"3",data:[],outline:l.coordinate&&m.coordinate?"2px solid":"",outlineColor:"#E53E3E",isEditing:{coordinate:p.coordinate.filter(h=>h).length?p.coordinate:$,onChange:h=>u("coordinate",[h.lat,h.lng])}}),e.jsx(v,{children:l.coordinate})]}),e.jsxs(S,{isInvalid:!!l.images&&m.images,children:[e.jsx(k,{children:"Foto"}),e.jsx(Ne,{values:p.images,onChange:h=>u("images",h)}),e.jsx(v,{children:l.images})]})]})}),e.jsxs(me,{borderTop:"1px solid",borderColor:"gray.200",children:[e.jsx(R,{onClick:()=>{c(),t()},children:"Batal"}),e.jsx(R,{colorScheme:"blue",ml:3,type:"submit",isLoading:i,children:"Kirim"})]})]})]})})]})}function We({pagination:a,dateState:n}){const[d,t]=n,r=a==null?void 0:a.next,s=a==null?void 0:a.previous,o=a==null?void 0:a.current;return e.jsxs(g,{justify:"space-between",w:"full",children:[e.jsx(L,{variant:"outline",icon:e.jsx(he,{}),"aria-label":"previous",isDisabled:!s,onClick:()=>s?t(s):null}),e.jsx(U,{variant:"outline",onFocus:i=>i.target.showPicker(),type:"date",textAlign:"center",max:F().format("YYYY-MM-DD"),onChange:i=>t(i.target.value),value:o||d}),e.jsx(L,{variant:"outline",icon:e.jsx(pe,{}),"aria-label":"next",isDisabled:!r,onClick:()=>r?t(r):null})]})}const ze=(a,n)=>!n.company||!a?{}:{nearCompany:n.company.companyId,distance:n.distance};function oa(){const{roleIsNot:a}=T(),n=B(),d=B(),[t,r]=y.useState({distance:250}),[s,o]=y.useState([]),i=F().format("YYYY-MM-DD"),p=y.useRef(),[u,C]=y.useState(i),{data:c,isLoading:m}=W(xe("/reports",{date:u,...ze(n.isOpen,t)}),z);return e.jsxs(D,{maxH:"100%",direction:"row",justify:"space-between",alignItems:"stretch",gap:"4",children:[e.jsx(x,{flex:"3 1 0",mb:"auto",position:"relative",h:"100%",overflowY:"auto",className:"custom-scrollbar",children:e.jsxs(I,{position:"absolute",pr:"3",w:"full",spacing:"3",children:[e.jsx(V,{w:"full",children:e.jsx(q,{children:e.jsxs(I,{spacing:"4",children:[e.jsx(Ee,{}),e.jsx(We,{pagination:c==null?void 0:c.pagination,dateState:[u,C]}),a("regular")&&e.jsx(Oe,{filterState:[t,r],filterDisclosure:n,showCompaniesState:[s,o],showCompaniesDisclosure:d})]})})}),e.jsxs(Q,{boxShadow:"sm",fontSize:"md",rounded:"md",variant:"left-accent",children:[m?e.jsx(Y,{thickness:"2px",colorScheme:"blue",boxSize:"20px",mr:"3"}):e.jsx(K,{}),e.jsx(J,{children:m?"Mengambil Data...":((c==null?void 0:c.result.length)||"Tidak ada")+(u===i?" aduan di 24 jam terakhir":" aduan pada tanggal "+F(u).format("DD MMM YYYY"))})]}),c==null?void 0:c.result.map((l,j)=>e.jsx(fe,{data:l,map:p.current},j))]})}),e.jsx(E,{flex:"5 1 0",h:"auto",marker:Z.RatingMarker,companiesData:d.isOpen?s:n.isOpen&&t.company?[t.company]:[],circleBoundaryRadius:n.isOpen?t.distance:void 0,data:(c==null?void 0:c.result.map(l=>({isReport:!0,...l})))||[],mapRef:p})]})}export{oa as default};
