import{H as O,r as p,j as a,V as R,K as W,J as U,T as D,F as K}from"./createReactComponent-BjMSnX4u.js";import{E as Q,V as X,u as V,J as $,m as z,e as Y,d as Z,M as _,g as aa,h as ea,i as sa,j as na,k as oa,o as ia,b as ta,f as ra,L as da,F as ca,q as la,W as ma,w as ua}from"./app-Dlg_0vKY.js";import{a as pa,b as ha,D as xa}from"./DeleteReourceButton-HzfbpiX8.js";import{H as ga}from"./HeadingWithIcon-DhQ1h7S6.js";import{S as B}from"./SectionTitle-CbtCqmUO.js";import{T as w}from"./TagWithIcon-BjtYG5-s.js";import{E as ja,U as fa}from"./EditInMapInputGroup-Db_htbNK.js";import{t as ba}from"./dateFormating-BW4zoMdD.js";import{g as ya,a as Ia}from"./commonColumn-BPdH03Da.js";import{M as Sa}from"./index-CmYfqyqM.js";import{N as Ca}from"./AddNodeSubscription-Bl36AeS8.js";import{u as q,a as ka,c as va}from"./common.utils-T8z9TsUm.js";import{I as Ma}from"./IconUsersGroup-DyLjGcvO.js";import{I as Na}from"./IconBuilding-K0rC28MR.js";import{I as A}from"./IconCirclePlus-XtyQ80kD.js";import{I as Pa}from"./IconTrees-DecgdE1d.js";import{c as t,B as S,F as T,e as Ba}from"./axios-DSJo49NX.js";import{H as h}from"./icon-CgCgY_AD.js";import{n as Da,b as Ea,d as Ta}from"./validator.utils-CBwZjXbt.js";import{u as Fa,c as La,F,b as L}from"./index.esm-C4YBZUZR.js";import{T as H}from"./chunk-4IH3O7BJ-s8F57N1M.js";import{I as Ua}from"./IconCalendar-CF1fZF0p.js";import{I as za}from"./IconEdit-Chltx2AE.js";import"./chunk-4YMKQ5D4-CSotNFLB.js";import"./GMapsButton-C93BsDGw.js";import"./chunk-K7XRJ7NL-k64nE7jn.js";import"./index.tags-CTXl78sl.js";import"./IconTrash-DOqppO8G.js";import"./IconExternalLink-BqvmzRBb.js";import"./chunk-4FCEGNGT-Dke9LU8Y.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Wa=O("outline","tag","IconTag",[["path",{d:"M7.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M3 6v5.172a2 2 0 0 0 .586 1.414l7.71 7.71a2.41 2.41 0 0 0 3.408 0l5.592 -5.592a2.41 2.41 0 0 0 0 -3.408l-7.71 -7.71a2 2 0 0 0 -1.414 -.586h-5.172a3 3 0 0 0 -3 3z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var $a=O("outline","user-heart","IconUserHeart",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h.5",key:"svg-1"}],["path",{d:"M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.242 2.242 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.242 2.242 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296z",key:"svg-2"}]]);function wa(r){const{data:s,mutate:d}=r,{companyId:e}=s,[c,n]=p.useState(null),[x,C]=p.useState(!1),[g,k]=p.useState(!1),[i,l]=p.useState(s.coordinate),j=Q(),o=X(),m=q(),{user:f,roleIs:v,roleIsNot:b}=V(),E=`/companies/${e}`,u=`/companies/${e}/nodes`,M=`/companies/${e}/private-nodes`,y=N=>{j({title:"Hapus Pengikuti Node",message:"Anda yakin hendak menghapus node ini dari daftar langganan",confirmButtonColor:"red",onConfirm:()=>z.delete(`${u}/${N}`).then(()=>{m.success("Node berhasil di-unsubcribe"),Y(P=>typeof P=="string"&&P.startsWith(u))}).catch(P=>{console.log(P),m.success("Node gagal di-unsubcribe")})})},I=async()=>{C(!0),z.patch(E,{coordinate:i}).then(()=>{m.success("Lokasi Perusahaan berhasil diperbarui"),d({...s,coordinate:i})}).catch(()=>{m.error("Lokasi Perusahaan gagal diperbarui")}).finally(()=>{k(!1),C(!1)})},G=p.useMemo(()=>ya(f.role,y),[]),J=p.useMemo(()=>Ia(),[]);return a.jsxs(a.Fragment,{children:[a.jsx(B,{IconEl:Ma,children:"Lokasi Perusahaan dan Node yang dikuti"}),a.jsxs(t,{children:[a.jsx(ja,{canEdit:b(["gov","regular"]),coordinate:s.coordinate,isEditingState:[g,k],editedCoordinateState:[i,l],isSubmiting:x,handleSubmitEditedCoordinate:I}),a.jsx(Sa,{w:"full",mt:"4",h:"300px",companiesData:[s],data:c||[],outline:g?"3px solid":"",outlineColor:"orange.300",isEditing:g?{coordinate:i||s.coordinate,onChange:N=>l([N.lat,N.lng])}:void 0})]}),a.jsxs(R,{align:"start",spacing:"6",mt:"6",children:[a.jsxs(t,{w:"full",children:[a.jsxs(h,{justify:"space-between",mb:"4",align:"start",w:"full",children:[a.jsxs(t,{children:[a.jsxs(h,{mb:"1",children:[a.jsx(W,{as:Na,boxSize:"20px"}),a.jsx(U,{size:"md",fontWeight:"600",children:"Node Privat"})]}),a.jsx(D,{children:"Daftar node yang terpasang dilingkungan perusahaan Anda"})]}),v(["admin","manager"])&&a.jsx(S,{leftIcon:a.jsx(A,{size:"18"}),colorScheme:"blue",children:"Tambah Node Private",onClick:()=>o("./create-node",{state:{company:{name:s.name,companyId:s.companyId,type:s.type}}})})]}),a.jsx($,{apiUrl:M,columns:J,emptyMsg:["Belum ada Node","Tambahkan Node sekarang"],hiddenPagination:!0})]}),a.jsxs(t,{w:"full",children:[a.jsxs(h,{justify:"space-between",mb:"4",align:"start",w:"full",children:[a.jsxs(t,{children:[a.jsxs(h,{mb:"1",children:[a.jsx(W,{as:Pa,boxSize:"20px"}),a.jsx(U,{size:"md",fontWeight:"600",children:"Node Publik"})]}),a.jsx(D,{children:"Daftar node publik yang diikuti perusahaan ini"})]}),v(["admin","manager"])&&a.jsx(Ca,{subsInfo:{type:"company",companyData:s},children:a.jsx(S,{leftIcon:a.jsx(A,{size:"18"}),colorScheme:"blue",children:"Tambah Node Publik"})})]}),a.jsx($,{apiUrl:u,columns:G,setDataContext:n,emptyMsg:["Belum ada Node","Tambahkan Node sekarang"],hiddenPagination:!0})]})]})]})}function Aa({data:r,mutate:s,...d}){const{isOpen:e,onOpen:c,onClose:n}=Z(),x=q(),{name:C,description:g,address:k}=r,i={name:C,description:g,address:k},{handleChange:l,values:j,errors:o,handleSubmit:m,handleBlur:f,resetForm:v,touched:b,isSubmitting:E,setSubmitting:u}=Fa({initialValues:i,validationSchema:La().shape({name:Da.required("Wajib diisi"),address:Ea.required("Wajib diisi"),description:Ta.required("Wajib diisi")}),onSubmit:M=>{ka(M);const y=va(i,M);if(Object.keys(y).length===0){x.opss("Belum ada yang disunting"),u(!1);return}z.patch(`/companies/${r.companyId}`,{...y}).then(()=>{x.success("Berhasil Memperharui data"),s(I=>I&&{...I,...y})}).catch(()=>{x.error("Gagal Memperharui data")}).finally(()=>{u(!1),n()})}});return a.jsxs(a.Fragment,{children:[a.jsx(S,{onClick:c,...d}),a.jsxs(_,{size:"lg",autoFocus:!1,isOpen:e,onClose:n,onCloseComplete:v,closeOnOverlayClick:!1,children:[a.jsx(aa,{}),a.jsx(ea,{children:a.jsxs("form",{onSubmit:m,className:"my-form",children:[a.jsx(sa,{children:"Sunting Profil"}),a.jsx(na,{children:a.jsxs(R,{mx:"auto",spacing:"2",maxW:"container.sm",children:[a.jsxs(T,{isInvalid:!!o.name&&b.name,children:[a.jsx(F,{children:"Nama"}),a.jsx(Ba,{id:"name",name:"name",placeholder:"Misal : Suparna",onChange:l,onBlur:f,value:j.name}),a.jsx(L,{children:o.name})]}),a.jsxs(T,{isInvalid:!!o.address&&b.address,children:[a.jsx(F,{children:"Alamat"}),a.jsx(H,{id:"address",name:"address",placeholder:"Masukkan Alamat Tempat tinggal Pengguna",onChange:l,onBlur:f,value:j.address}),a.jsx(L,{children:o.address})]}),a.jsxs(T,{isInvalid:!!o.description&&b.description,children:[a.jsx(F,{children:"Description"}),a.jsx(H,{id:"description",name:"description",placeholder:"Opsional",onChange:l,onBlur:f,value:j.description}),a.jsx(L,{children:o.description})]})]})}),a.jsxs(oa,{children:[a.jsx(S,{variant:"ghost",onClick:n,children:"Batal"}),a.jsx(S,{isLoading:E,type:"submit",colorScheme:"blue",ml:3,children:"Submit"})]})]})})]})]})}function je(){const{id:r}=ia(),{user:s,roleIs:d}=V(),{data:e,mutate:c,error:n}=ta(`/companies/${r}`,ra);if(n)throw n;return e?a.jsxs(t,{children:[a.jsx(ga,{Icon:a.jsx($a,{}),text:"Detail Perusahaan"}),a.jsxs(K,{mt:"8",maxW:"container.md",children:[a.jsxs(h,{justify:"space-between",children:[a.jsxs(t,{children:[a.jsx(U,{fontSize:"3xl",children:e.name}),a.jsxs(h,{mt:"2",children:[a.jsx(w,{icon:Ua,colorScheme:"blue",children:`Dibuat pada ${ba(e.createdAt)}`}),a.jsx(w,{icon:Wa,colorScheme:ca[e.type].color,textTransform:"capitalize",children:e.type})]}),["admin","gov"].includes(s.role)&&a.jsx(fa,{mt:"3",data:e.manager,label:"manager"})]}),a.jsx(la,{}),a.jsx(ma,{alignSelf:"start",companyId:e.companyId}),d(["admin","manager"])&&a.jsx(Aa,{data:e,mutate:c,colorScheme:"blue",alignSelf:"start",leftIcon:a.jsx(za,{size:"16"}),children:"Sunting Perusahaan"})]}),a.jsx(B,{IconEl:pa,children:"Alamat"}),a.jsx(D,{children:e.address}),a.jsx(B,{IconEl:ha,children:"Deskripsi Perusahaan"}),a.jsx(D,{children:e.description}),a.jsx(wa,{data:e,mutate:c}),d(["admin","manager"])&&a.jsxs(a.Fragment,{children:[a.jsx(B,{IconEl:ua,children:"Lainnya"}),a.jsx(xa,{resource:"Perusahaan",name:e.name,colorScheme:"red",deleteApiUrl:"/companies/"+e.companyId,redirectPath:"/companies"})]})]})]}):a.jsx(da,{})}export{je as default};
