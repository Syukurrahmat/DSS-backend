import{g as Ie,f as V,h as Ce,o as ke,j as e,b as _,c as O,K as P,r as y,H as c,F as G,L as U,T as h,M as ne,C as p,D as b,N,V as ve,Z as D,Q as Z,J as X,E as De}from"./createReactComponent-m2GCamtz.js";import{E as oe,F as ze,v as te,r as B,G as re,H as ie,J as le,c as S,m as w,K as Te,N as Me,b as Le,q as K,M as Ne,d as Be,e as we,f as Fe,g as Pe,h as Ae,u as ce,k as Ee,p as He,L as Ue,O as Y,P as We,z as $e,Q as ee,x as Re}from"./app-BlQRCkbL.js";import{S as j}from"./SectionTitle-CXF1AUe9.js";import{T as Ve}from"./TagWithIcon-BmQxVHBm.js";import{I as _e,a as Oe,C as Ge}from"./managerCard-CmoI7cC9.js";import{t as q,T as A,a as de}from"./dateFormating-CjiM6gKV.js";import{a as Ke}from"./index.tags-vBYpzwqj.js";import{u as E}from"./useApiResponseToast-CR3ZylCY.js";import{I as F}from"./IconTrash-CmToVWU0.js";import{I as me}from"./IconExternalLink-pP3M5HlB.js";import{I as ue}from"./IconUsersGroup-D7nlVQeI.js";import{M as qe}from"./MyLineChart-DYDC_vRb.js";import{F as he}from"./chunk-KRPLQIP4-1nj_ibqy.js";import{T as Je,a as Qe,b as Ze,c as Xe,d as Ye}from"./chunk-IAXSQ4X2-BWbuaJl8.js";import{N as es}from"./NamewithAvatar-CIkhhQ32.js";import{L as ss}from"./chunk-K7XRJ7NL-DVxbvYYn.js";import{a as as,c as ns}from"./common.utils-BXgvsAbj.js";import{n as os,d as ts,b as rs}from"./validator.utils-BSOb9322.js";import{u as is}from"./formik.esm-X4pWCQgU.js";import{c as ls,f as cs,F as z,b as T}from"./index.esm-DXWgZSHY.js";import{T as se}from"./chunk-4IH3O7BJ-BSUfzZnZ.js";import{M as ds}from"./index-Dt6lv0Jl.js";import{G as ms}from"./GMapsButton-CMg_SpqN.js";import{I as pe}from"./IconEdit-DHHo-74T.js";import{I as us}from"./IconCalendar-DeQmHFDN.js";import{b as hs,a as ps}from"./IconTextCaption-DuaqrD48.js";import{I as ae}from"./IconInfoCircle-DF-YfKml.js";import"./chunk-V7PAE35Z-BuEgg6Tf.js";import"./index-CH91JLn2.js";import"./index-B4MCLp8v.js";var[xs,xe]=Ie({name:"StatStylesContext",errorMessage:`useStatStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Stat />" `}),W=V(function(r,l){const s=Ce("Stat",r),t={position:"relative",flex:"1 1 0%",...s.container},{className:i,children:o,...u}=ke(r);return e.jsx(xs,{value:s,children:e.jsx(_.div,{ref:l,...u,className:O("chakra-stat",i),__css:t,children:e.jsx("dl",{children:o})})})});W.displayName="Stat";var $=V(function(r,l){const s=xe();return e.jsx(_.dt,{ref:l,...r,className:O("chakra-stat__label",r.className),__css:s.label})});$.displayName="StatLabel";var R=V(function(r,l){const s=xe();return e.jsx(_.dd,{ref:l,...r,className:O("chakra-stat__number",r.className),__css:{...s.number,fontFeatureSettings:"pnum",fontVariantNumeric:"proportional-nums"}})});R.displayName="StatNumber";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var js=P("outline","chart-bubble","IconChartBubble",[["path",{d:"M6 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-0"}],["path",{d:"M16 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14.5 7.5m-4.5 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 1 0 -9 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var gs=P("outline","inner-shadow-top","IconInnerShadowTop",[["path",{d:"M5.636 5.636a9 9 0 1 0 12.728 12.728a9 9 0 0 0 -12.728 -12.728z",key:"svg-0"}],["path",{d:"M16.243 7.757a6 6 0 0 0 -8.486 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var fs=P("outline","map-check","IconMapCheck",[["path",{d:"M11 18l-2 -1l-6 3v-13l6 -3l6 3l6 -3v9",key:"svg-0"}],["path",{d:"M9 4v13",key:"svg-1"}],["path",{d:"M15 7v8",key:"svg-2"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var bs=P("outline","trending-up","IconTrendingUp",[["path",{d:"M3 17l6 -6l4 4l8 -8",key:"svg-0"}],["path",{d:"M14 7l7 0l0 7",key:"svg-1"}]]);const M=le();function Ss({data:n,mutate:r}){let{nodeId:l,countCompanySubscribtion:s}=n;const t=oe(),{apiResponseToast:i}=E(),o=`/nodes/${l}/companies`,u=a=>{t({title:"Hapus Usaha",message:"Hapus pengguna dari daftar pelanggan node "+n.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(b+o+"?subscriptionid="+a).then(({data:m})=>i(m,{onSuccess:()=>{w(d=>d&&d[0]==o),r()}}))})},g=()=>{t({title:"Hapus Semua Usaha",message:"Hapus Semua usaha dari daftar pelanggan node "+n.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(b+o+"?all=true").then(({data:a})=>i(a,{onSuccess:()=>{w(m=>m&&m[0]==o),r()}}))})},f=y.useMemo(()=>[M.accessor("name",{header:"Nama",cell:a=>{const{color:m,icon:d}=ze[a.row.original.type];return e.jsxs(c,{spacing:"3",children:[e.jsx(G,{rounded:"md",border:"2px solid",borderColor:m+".200",color:m+".500",p:"2",children:e.jsx(U,{as:d,boxSize:"18px"})}),e.jsx(h,{children:a.getValue()})]})},meta:{sortable:!0}}),M.accessor("type",{header:"Jenis ",cell:a=>e.jsx(Ke,{value:a.getValue()}),meta:{sortable:!0}}),M.accessor("joinedAt",{header:"Berlangganan sejak",cell:a=>q(a.getValue()),meta:{sortable:!0}}),M.accessor("subscriptionId",{header:"Aksi",cell:a=>e.jsxs(c,{children:[e.jsx(ne,{size:"sm",colorScheme:"red",icon:e.jsx(F,{size:"16"}),"aria-label":"Hapus",onClick:()=>u(a.getValue())}),e.jsx(te,{to:"/companies/"+a.row.original.companyId,children:e.jsx(p,{colorScheme:"blue",size:"sm",leftIcon:e.jsx(me,{size:"16"}),children:"Lihat Usaha"})})]})})],[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{IconEl:ue,children:["Daftar Usaha yang mengikuti node ini",e.jsx(A,{colorScheme:"blue",ml:"2",children:s||0})]}),e.jsxs(c,{mt:"4",children:[!!s&&e.jsx(p,{colorScheme:"red",leftIcon:e.jsx(F,{size:"18"}),onClick:g,children:"Hapus Semua Usaha"}),e.jsx(B,{}),e.jsx(re,{rounded:"md",bg:"white",placeholder:"Cari Usaha",_onSubmit:null})]}),e.jsx(ie,{mt:"4",apiUrl:o,columns:f,emptyMsg:["Belum ada Usaha"]})]})}function ys({data:n,lastDataSent:r}){const l=[{key:"pm25",name:"PM2.5",unit:"µm/m3"},{key:"pm100",name:"PM10",unit:"µm/m3"},{key:"ch4",name:"Karbon dioksida",unit:"PPM"},{key:"co2",name:"Metana",unit:"PPM"}];return e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:Te,children:"Data terakhir dikirim"}),r?e.jsxs(e.Fragment,{children:[e.jsxs(c,{my:"3",children:[e.jsx(gs,{size:"20"}),e.jsx(h,{fontWeight:"600",children:"Data Terbaru"}),e.jsx(A,{children:de(r)})]}),e.jsx(he,{gap:"2",children:l.map(({name:s,key:t,unit:i})=>e.jsxs(N,{flex:"1 0 0px",py:"2",px:"4",border:"2px solid",borderColor:"gray.200",rounded:"md",children:[e.jsx(h,{fontWeight:"600",children:s}),e.jsxs(c,{align:"baseline",children:[e.jsx(h,{fontWeight:"600",fontSize:"xl",children:n&&n[0][t]}),e.jsx(h,{fontSize:"sm",children:i})]})]},t))}),e.jsxs(c,{mb:"2",mt:"4",children:[e.jsx(bs,{size:"20"}),e.jsx(h,{fontWeight:"600",children:"Tren 24 jam terakhir"})]}),e.jsxs(Je,{isLazy:!0,size:"sm",children:[e.jsx(Qe,{children:l.map(({name:s,key:t})=>e.jsx(Ze,{children:s},t))}),e.jsx(Xe,{children:l.map(({key:s})=>e.jsx(Ye,{children:e.jsx(N,{w:"full",h:"280px",as:n?void 0:Me,children:!!n&&e.jsx(qe,{data:n,withoutLegend:!0,dataKeyTypeAndFunc:{envType:"outdoor",func:t=>t[s]}})})},s))})]})]}):e.jsx(G,{w:"full",py:"5",children:e.jsx(h,{fontWeight:"600",color:"gray.500",fontSize:"xl",children:"Node Belum Pernah Mengirim Data"})})]})}const L=le();function Is({data:n,mutate:r}){let{nodeId:l,countUserSubscription:s}=n;const t=oe(),{apiResponseToast:i}=E(),o=`/nodes/${l}/users`,u=a=>{t({title:"Hapus Pengguna",message:"Hapus pengguna dari daftar pelanggan node "+n.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(b+o+"?subscriptionid="+a).then(({data:m})=>i(m,{onSuccess:()=>{w(d=>d&&d[0]==o),r()}}))})},g=()=>{t({title:"Hapus Semua Pengguna",message:"Hapus Semua pengguna dari daftar pelanggan node "+n.name,confirmButtonColor:"red",onConfirm:async()=>S.delete(b+o+"?all=true").then(({data:a})=>i(a,{onSuccess:()=>{w(m=>m&&m[0]==o),r()}}))})},f=y.useMemo(()=>[L.accessor("name",{header:"Nama",cell:a=>e.jsx(es,{name:a.getValue()}),meta:{sortable:!0}}),L.accessor("phone",{header:"Telepon",cell:a=>e.jsx(ss,{href:"tel:+62"+a.getValue(),children:a.getValue()})}),L.accessor("joinedAt",{header:"Berlangganan sejak",cell:a=>q(a.getValue()),meta:{sortable:!0}}),L.accessor("subscriptionId",{header:"Aksi",cell:a=>e.jsxs(c,{children:[e.jsx(ne,{size:"sm",colorScheme:"red",icon:e.jsx(F,{size:"16"}),"aria-label":"Hapus",onClick:()=>u(a.getValue())}),e.jsx(te,{to:"/users/"+a.row.original.userId,children:e.jsx(p,{colorScheme:"blue",size:"sm",leftIcon:e.jsx(me,{size:"16"}),children:"Lihat Pengguna"})})]})})],[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{IconEl:ue,children:["Daftar Pengguna yang mengikuti node ini",e.jsx(A,{colorScheme:"blue",ml:"2",children:s||0})]}),e.jsxs(c,{mt:"4",justify:"space-between",children:[!!s&&e.jsx(p,{colorScheme:"red",leftIcon:e.jsx(F,{size:"18"}),onClick:g,children:"Hapus Semua Pengguna"}),e.jsx(B,{}),e.jsx(re,{rounded:"md",bg:"white",placeholder:"Cari Pengguna",_onSubmit:null})]}),e.jsx(ie,{mt:"4",apiUrl:o,columns:f,emptyMsg:["Belum ada Pengguna"]})]})}function Cs({data:n,mutate:r,...l}){const{isOpen:s,onOpen:t,onClose:i}=Le(),{apiResponseToast:o,toast:u}=E(),{name:g,description:f,address:a,instalationDate:m}=n,d={name:g,description:f,address:a,instalationDate:m},{id:je}=K(),ge=`${b}/nodes/${je}`,{handleChange:I,values:C,errors:x,handleSubmit:fe,handleBlur:k,resetForm:be,touched:v,isSubmitting:Se,setSubmitting:J}=is({initialValues:d,validationSchema:ls().shape({name:os.required("Wajib diisi"),description:ts.required("Wajib diisi"),address:rs.required("Wajib diisi"),instalationDate:cs().nullable()}),onSubmit:H=>{as(H);const Q=ns(d,H);if(Object.keys(Q).length===0){u({title:"Opss !!!",description:"Belum ada yang disunting",status:"warning"}),J(!1);return}S.put(ge,{...Q,nodeId:n.nodeId}).then(({data:ye})=>{J(!1),o(ye,{onSuccess(){r({...n,...H}),i()}})})}});return e.jsxs(e.Fragment,{children:[e.jsx(p,{onClick:t,...l}),e.jsxs(Ne,{size:"lg",autoFocus:!1,isOpen:s,onClose:i,closeOnOverlayClick:!1,children:[e.jsx(Be,{}),e.jsx(we,{children:e.jsxs("form",{onSubmit:fe,className:"my-form",children:[e.jsx(Fe,{children:"Sunting Profil"}),e.jsx(Pe,{children:e.jsxs(ve,{mx:"auto",spacing:"2",maxW:"container.sm",children:[e.jsxs(D,{isInvalid:!!x.name&&v.name,children:[e.jsx(z,{children:"Nama"}),e.jsx(Z,{id:"name",name:"name",placeholder:"Misal : Suparna",onChange:I,onBlur:k,value:C.name}),e.jsx(T,{children:x.name})]}),e.jsxs(D,{isInvalid:!!x.description&&v.description,children:[e.jsx(z,{children:"Description"}),e.jsx(se,{id:"description",name:"description",placeholder:"Opsional",onChange:I,onBlur:k,value:C.description}),e.jsx(T,{children:x.description})]}),e.jsxs(D,{isInvalid:!!x.address&&v.address,children:[e.jsx(z,{children:"Alamat"}),e.jsx(se,{id:"address",name:"address",placeholder:"Opsional",onChange:I,onBlur:k,value:C.address}),e.jsx(T,{children:x.address})]}),e.jsxs(D,{isInvalid:!!x.instalationDate&&v.instalationDate,children:[e.jsx(z,{children:"Tanggal Instalasi"}),e.jsx(Z,{id:"instalationDate",name:"instalationDate",type:"date",onChange:I,onBlur:k,value:C.instalationDate}),e.jsx(T,{children:x.instalationDate})]})]})}),e.jsxs(Ae,{children:[e.jsx(p,{variant:"ghost",onClick:()=>{be(),i()},children:"Batal"}),e.jsx(p,{isLoading:Se,type:"submit",colorScheme:"blue",ml:3,children:"Submit"})]})]})})]})]})}function ks({data:n,mutate:r}){const[l,s]=y.useState(n.coordinate),[t,i]=y.useState(!1),[o,u]=y.useState(!1),{apiResponseToast:g}=E(),{id:f}=K(),{user:a}=ce(),m=async()=>{i(!0);const{data:d}=await S.put(`${b}/nodes/${f}`,{coordinate:l,nodeId:n.nodeId});i(!1),g(d,{onSuccess(){r({...n,coordinate:l}),u(!1)}})};return e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:fs,children:"Letak Node"}),e.jsxs(c,{justify:"space-between",children:[!o&&e.jsxs(e.Fragment,{children:[e.jsx(ms,{size:"md",coordinate:n.coordinate}),e.jsx(B,{}),["admin","manager"].includes(a.role)&&!n.companyId&&e.jsx(p,{leftIcon:e.jsx(pe,{size:"20"}),colorScheme:"yellow",children:"Ubah posisi",onClick:()=>u(d=>!d),isDisabled:t})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx(h,{fontSize:"sm",children:"Geser peta dan paskan penanda ke titik yang dimaksud"}),e.jsx(B,{}),e.jsx(p,{colorScheme:"red",leftIcon:e.jsx(_e,{size:"18"}),children:"Batal",onClick:()=>u(!1),isDisabled:t}),e.jsx(p,{colorScheme:"blue",leftIcon:e.jsx(Oe,{size:"18"}),children:"Simpan",isLoading:t,onClick:m})]})]}),e.jsx(ds,{mt:"4",data:[n],outline:o?"3px solid":"",outlineColor:"orange.300",isEditing:o?{coordinate:n.coordinate,onChange:d=>s([d.lat,d.lng])}:void 0})]})}function sa(){var u;const{id:n}=K(),{roleIs:r}=ce(),l=`/nodes/${n}`,{data:s,mutate:t}=Ee(l,He);if(!s)return e.jsx(Ue,{});const i=Y[s.status]||Y.active,o=We[s.companyId?"private":"public"];return e.jsxs(N,{children:[e.jsx(c,{w:"full",spacing:"4",align:"start",children:e.jsxs(c,{spacing:"3",children:[e.jsx(G,{boxSize:"30px",boxShadow:"xs",bg:"gray.100",rounded:"md",p:"1",children:e.jsx($e,{})}),e.jsx(X,{fontSize:"xl",fontWeight:"600",children:"Detail Node"})]})}),e.jsxs(De,{mt:"8",maxW:"container.md",children:[e.jsxs(c,{spacing:"4",justify:"space-between",children:[e.jsxs(N,{children:[e.jsx(X,{fontSize:"3xl",children:s.name}),e.jsx(c,{mt:"2",children:!!s.instalationDate&&e.jsx(Ve,{icon:us,colorScheme:"orange",children:`Node dipasang pada ${q(s.instalationDate)}`})}),s.owner&&e.jsx(Ge,{mt:"3",data:s.owner})]}),r("admin")&&e.jsx(Cs,{data:s,mutate:t,colorScheme:"blue",alignSelf:"start",leftIcon:e.jsx(pe,{size:"16"}),children:"Sunting Profil"})]}),e.jsx(j,{IconEl:hs,children:"Deskripsi Node"}),e.jsx(h,{children:s.description}),e.jsx(j,{IconEl:ps,children:"Alamat"}),e.jsx(h,{children:s.address}),e.jsx(j,{IconEl:js,children:"Status"}),e.jsxs(he,{mt:"3",gap:"4",flexWrap:"wrap",children:[e.jsxs(W,{flex:"1 0 100px",bg:i.color+".50",p:"4",rounded:"md",border:"2px solid",borderColor:i.color+".400",children:[e.jsx($,{children:"Status"}),e.jsxs(c,{spacing:"2",my:"1",children:[e.jsx(U,{as:i.icon,boxSize:"28px"}),e.jsx(R,{textTransform:"capitalize",children:i.name})]}),e.jsxs(c,{children:[e.jsx(ae,{size:"16"}),e.jsx(h,{fontSize:"sm",children:i.note})]}),e.jsx(ee,{borderColor:i.color,mt:"3",mb:"2"}),e.jsxs(h,{fontSize:"sm",children:["Terakhir data diperbarui"," ",de(s.lastDataSent)]})]}),e.jsxs(W,{flex:"1 0 100px",bg:o.color+".50",p:"4",rounded:"md",border:"2px solid",borderColor:o.color+".400",children:[e.jsx($,{children:"Kepemilikan"}),e.jsxs(c,{spacing:"2",my:"1",children:[e.jsx(U,{as:o.icon,boxSize:"28px"}),e.jsx(R,{textTransform:"capitalize",children:o.name})]}),e.jsxs(c,{children:[e.jsx(ae,{size:"16"}),e.jsx(h,{fontSize:"sm",children:o.note})]}),e.jsx(ee,{borderColor:o.color,mt:"3",mb:"2"}),e.jsxs(c,{fontSize:"sm",align:"baseline",children:[e.jsx(h,{children:"Dikelola oleh: "}),e.jsx(A,{size:"sm",fontSize:"xs",children:((u=s.owner)==null?void 0:u.name)||"Admin"})]})]})]}),e.jsx(ks,{data:s,mutate:t}),!s.companyId&&r("admin")&&e.jsxs(e.Fragment,{children:[e.jsx(Ss,{data:s,mutate:t}),e.jsx(Is,{data:s,mutate:t})]}),e.jsx(ys,{data:s.dataLogs,lastDataSent:s.lastDataSent,mutate:t}),r("admin")&&e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:Re,children:"Lainnya"}),e.jsx(p,{colorScheme:"red",children:"Hapus Node"})]})]})]})}export{sa as default};
