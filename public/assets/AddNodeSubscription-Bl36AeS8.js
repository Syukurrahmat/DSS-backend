import{H as C,r as j,j as e,V as M,J as F,T as f}from"./createReactComponent-BjMSnX4u.js";import{d as P,a5 as W,b as I,f as N,M as A,g as E,h as $,i as V,j as X,H as q,O as T,k as G,m as J,e as S}from"./app-Dlg_0vKY.js";import{b as Q,g as _,P as K,M as Y}from"./index-CmYfqyqM.js";import{u as Z}from"./common.utils-T8z9TsUm.js";import{b as ee}from"./index.tags-CTXl78sl.js";import{H as k}from"./icon-CgCgY_AD.js";import{T as H,b as v,c as ae}from"./dateFormating-BW4zoMdD.js";import{B as g,c as se}from"./axios-DSJo49NX.js";import{M as ne}from"./chunk-4FCEGNGT-Dke9LU8Y.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var te=C("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var oe=C("outline","x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);const ie=(n,d)=>{function o({properties:a,...r}){const i=j.useRef(),{nodeId:h}=a,p=!!n.find(l=>l.nodeId==h),x=()=>{var l;(l=i.current)==null||l.closePopup(),setTimeout(()=>{const{name:b,nodeId:c}=a;d({name:b,nodeId:c})},300)};return e.jsx(Q,{icon:_(a.isSubscribed?"subscribed":p?"selected":"unselected"),ref:i,...r,children:e.jsx(K,{className:"map-popup",offset:[0,-16],children:e.jsxs(M,{align:"start",spacing:"1",children:[e.jsx(F,{size:"sm",textTransform:"capitalize",children:a.name}),e.jsx(k,{mb:"2",children:e.jsx(ee,{value:a.isUptodate})}),a.isSubscribed?e.jsx(H,{variant:"outline",w:"full",children:e.jsx(v,{w:"full",textAlign:"center",children:"Sudah diikuti"})}):p?e.jsx(g,{leftIcon:e.jsx(oe,{size:"14"}),colorScheme:"red",size:"xs",w:"full",onClick:x,children:"Batal Pilih"}):e.jsx(g,{leftIcon:e.jsx(te,{size:"14"}),colorScheme:"blue",size:"xs",w:"full",onClick:x,children:"Pilih Node"})]})})})}return o};function ge({subsInfo:n,...d}){const o=Z(),[a,r]=j.useState([]),[i,h]=j.useState(!1),{isOpen:p,onOpen:x,onClose:l}=P(),b=n.type==="user"?`/users/${n.userId}`:`/companies/${n.companyData.companyId}`,c=b+"/nodes",B=b+"/dashboard",R=n.type==="user"?{forUserSubs:n.userId}:{forCompanySubs:n.companyData.companyId},D=`/nodes/subscribeable?${W.stringify(R)}`,z=`${c}/limit`,{data:m,mutate:y}=I(z,N),L=()=>o.opss(`Node yang diikuti dibatasi maksimal 5 node, 
Hapus node yang lain terlebih dahulu untuk menambahkan `),O=t=>{if(m!==void 0){if(a.length>=m)return L();r(s=>s.find(u=>u.nodeId==t.nodeId)?s.filter(u=>u.nodeId!==t.nodeId):[...s,t])}},U=async()=>{if(!a.length)return o.opss("Sepertinya Anda belum menambahkan Node");h(!0);const t=a.map(s=>s.nodeId);J.patch(c,{nodeIds:t}).then(()=>{o.success(t.length+" node publik berhasil ditambahkan"),S(s=>typeof s=="string"&&s.startsWith(c)),S(s=>typeof s=="string"&&s.startsWith(B)),y(s=>(s||0)-t.length)}).catch(()=>{o.error("Node publik gagal ditambahkan")}).finally(()=>{h(!1),l()})};return e.jsxs(e.Fragment,{children:[e.jsx(se,{onClick:()=>{x(),y()},children:d.children}),e.jsxs(A,{closeOnEsc:!1,closeOnOverlayClick:!1,size:"5xl",isOpen:p,onClose:l,onCloseComplete:()=>r([]),children:[e.jsx(E,{}),e.jsxs($,{children:[e.jsx(V,{children:"Tambah Ikuti Node Publik"}),!i&&e.jsx(ne,{}),e.jsx(X,{py:"0",children:m!==void 0?e.jsx(e.Fragment,{children:m?e.jsxs(e.Fragment,{children:[e.jsxs(k,{mb:"3",alignItems:"start",children:[e.jsx(k,{wrap:"wrap",minH:"35px",py:"1",px:"2",flexGrow:"1",rounded:"md",border:"1px solid",borderColor:"gray.200",children:a.length?a.map(({nodeId:t,name:s})=>e.jsxs(H,{colorScheme:"blue",children:[e.jsx(v,{children:s}),e.jsx(ae,{onClick:()=>r(u=>u.filter(w=>w.nodeId!==t))})]},t)):e.jsx(f,{color:"gray.500",children:"Belum ada yang dipilih"})}),e.jsx(q,{minW:"230px",_onSubmit:null,placeholder:"Cari node"})]}),e.jsx(le,{selectedNodes:a,onSelectChange:O,apiURL:D,companyData:n.type=="company"?n.companyData:void 0})]}):e.jsxs(M,{children:[e.jsx(f,{fontWeight:"600",fontSize:"lg",children:"Node yang diikuti dibatasi maksimal 5 node,"}),e.jsx(f,{children:"Hapus node yang lain terlebih dahulu untuk menambahkan"})]})}):e.jsx(T,{h:"300px",rounded:"md"})}),e.jsxs(G,{children:[e.jsx(g,{colorScheme:"gray",mr:3,isDisabled:i,onClick:l,children:"Batal"}),!!m&&e.jsx(g,{isLoading:i,colorScheme:"blue",onClick:U,children:"Tambahkan"})]})]})]})]})}function le(n){const{selectedNodes:d,companyData:o,onSelectChange:a,apiURL:r}=n,{data:i}=I(r,N);return e.jsx(e.Fragment,{children:e.jsx(Y,{focusInOneCompany:!0,companiesData:o?[o]:[],marker:ie(d,a),data:i||[],as:i?void 0:T,centerAuto:!1})})}export{ge as N};
