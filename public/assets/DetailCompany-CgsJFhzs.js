import{r as h,j as a,a0 as t,V as O,U as r,I as W,W as F,Y as M,F as V}from"./font-Qhbu9OiB.js";import{H as K,y as Y,u as H,O as $,m as L,e as _,d as J,M as Q,g as X,h as Z,i as aa,j as ea,k as sa,o as na,b as oa,f as ia,L as ta,K as ra,z as da,q as ca,_ as la,w as ma}from"./app-OFdP0MLv.js";import{a as ua,b as pa,D as ha}from"./DeleteReourceButton-C0_hR33K.js";import{H as xa}from"./HeadingWithIcon--ct6StFl.js";import{S as B}from"./SectionTitle-D0hFF5d1.js";import{T as ga}from"./TagWithIcon-CCVojo9e.js";import{E as ja,U as fa}from"./EditInMapInputGroup-JcynrRfB.js";import{t as ba}from"./dateFormating-k4McqWkx.js";import{g as Ia,a as ya}from"./commonColumn-hbQ1TCBL.js";import{M as Sa}from"./index-ClY7xd3L.js";import{N as Ca}from"./AddNodeSubscription-B3B7l3TU.js";import{u as R,a as ka,c as Na}from"./common.utils-KfV-hsLd.js";import{I as Pa}from"./IconUsersGroup-Br_L0Opu.js";import{I as va}from"./IconBuilding-C0ElbpSL.js";import{I as z}from"./IconCirclePlus-D17UvEMI.js";import{I as Ba}from"./IconTrees-B9X5JGb9.js";import{B as S,F as E,c as Ma}from"./logo-white-Cvs5dC_u.js";import{n as Da,b as Ea,d as wa}from"./validator.utils-BbPBxsiX.js";import{u as Ta,c as Fa,F as w,b as T}from"./index.esm-BrGPXCIo.js";import{T as A}from"./chunk-4IH3O7BJ-B7oiDjaY.js";import{I as La}from"./IconCalendar-Cb4TI5xO.js";import{I as Ua}from"./IconEdit-NNTSMBKd.js";import"./logo-C54eNvEo.js";import"./chunk-4YMKQ5D4-BNLh7UBr.js";import"./GMapsButton-CgdXXPem.js";import"./chunk-K7XRJ7NL-CWPidkYl.js";import"./IconTrash-DhW0IJVI.js";import"./IconExternalLink-Cn_MB6PB.js";import"./chunk-4FCEGNGT-CjW0cQ47.js";function Wa(d){const{data:s,mutate:c}=d,{companyId:e}=s,[l,n]=h.useState(null),[x,C]=h.useState(!1),[g,k]=h.useState(!1),[i,m]=h.useState(s.coordinate),j=K(),o=Y(),u=R(),{user:f,roleIs:N,roleIsNot:b}=H(),D=`/companies/${e}`,p=`/companies/${e}/nodes`,P=`/companies/${e}/private-nodes`,I=v=>{j({title:"Hapus Pengikuti Node",message:"Anda yakin hendak menghapus node ini dari daftar langganan",confirmButtonColor:"red",onConfirm:()=>L.delete(`${p}/${v}`).then(()=>{u.success("Node berhasil di-unsubcribe"),_(U=>typeof U=="string"&&U.startsWith(p))}).catch(()=>{u.success("Node gagal di-unsubcribe")})})},y=async()=>{C(!0),L.patch(D,{coordinate:i}).then(()=>{u.success("Lokasi Perusahaan berhasil diperbarui"),c({...s,coordinate:i})}).catch(()=>{u.error("Lokasi Perusahaan gagal diperbarui")}).finally(()=>{k(!1),C(!1)})},q=h.useMemo(()=>Ia(f.role,I),[]),G=h.useMemo(()=>ya(),[]);return a.jsxs(a.Fragment,{children:[a.jsx(B,{IconEl:Pa,children:"Lokasi Perusahaan dan Node yang dikuti"}),a.jsxs(t,{children:[a.jsx(ja,{canEdit:b(["gov","regular"]),coordinate:s.coordinate,isEditingState:[g,k],editedCoordinateState:[i,m],isSubmiting:x,handleSubmitEditedCoordinate:y}),a.jsx(Sa,{w:"full",mt:"4",h:"300px",companiesData:[s],data:l||[],outline:g?"3px solid":"",outlineColor:"orange.300",isEditing:g?{coordinate:i||s.coordinate,onChange:v=>m([v.lat,v.lng])}:void 0})]}),a.jsxs(O,{align:"start",spacing:"6",mt:"6",children:[a.jsxs(t,{w:"full",children:[a.jsxs(r,{wrap:"wrap",justify:"space-between",mb:"4",align:"start",w:"full",children:[a.jsxs(t,{children:[a.jsxs(r,{mb:"1",children:[a.jsx(W,{as:va,boxSize:"20px"}),a.jsx(F,{size:"md",fontWeight:"600",children:"Node Privat"})]}),a.jsx(M,{children:"Daftar node yang terpasang dilingkungan perusahaan Anda"})]}),N(["admin","manager"])&&a.jsx(S,{leftIcon:a.jsx(z,{size:"18"}),colorScheme:"blue",children:"Tambah Node Private",onClick:()=>o("./create-node",{state:{company:{name:s.name,companyId:s.companyId,type:s.type}}})})]}),a.jsx($,{apiUrl:P,columns:G,emptyMsg:["Belum ada Node","Tambahkan Node sekarang"],hiddenPagination:!0})]}),a.jsxs(t,{w:"full",children:[a.jsxs(r,{wrap:"wrap",justify:"space-between",mb:"4",align:"start",w:"full",children:[a.jsxs(t,{children:[a.jsxs(r,{mb:"1",children:[a.jsx(W,{as:Ba,boxSize:"20px"}),a.jsx(F,{size:"md",fontWeight:"600",children:"Node Publik"})]}),a.jsx(M,{children:"Daftar node publik yang diikuti perusahaan ini"})]}),N(["admin","manager"])&&a.jsx(Ca,{subsInfo:{type:"company",companyData:s},children:a.jsx(S,{leftIcon:a.jsx(z,{size:"18"}),colorScheme:"blue",children:"Tambah Node Publik"})})]}),a.jsx($,{apiUrl:p,columns:q,setDataContext:n,emptyMsg:["Belum ada Node","Tambahkan Node sekarang"],hiddenPagination:!0})]})]})]})}function $a({data:d,mutate:s,...c}){const{isOpen:e,onOpen:l,onClose:n}=J(),x=R(),{name:C,description:g,address:k}=d,i={name:C,description:g,address:k},{handleChange:m,values:j,errors:o,handleSubmit:u,handleBlur:f,resetForm:N,touched:b,isSubmitting:D,setSubmitting:p}=Ta({initialValues:i,validationSchema:Fa().shape({name:Da.required("Wajib diisi"),address:Ea.required("Wajib diisi"),description:wa.required("Wajib diisi")}),onSubmit:P=>{ka(P);const I=Na(i,P);if(Object.keys(I).length===0){x.opss("Belum ada yang disunting"),p(!1);return}L.patch(`/companies/${d.companyId}`,{...I}).then(()=>{x.success("Berhasil Memperharui data"),s(y=>y&&{...y,...I})}).catch(()=>{x.error("Gagal Memperharui data")}).finally(()=>{p(!1),n()})}});return a.jsxs(a.Fragment,{children:[a.jsx(S,{onClick:l,...c}),a.jsxs(Q,{size:"lg",autoFocus:!1,isOpen:e,onClose:n,onCloseComplete:N,closeOnOverlayClick:!1,children:[a.jsx(X,{}),a.jsx(Z,{children:a.jsxs("form",{onSubmit:u,className:"my-form",children:[a.jsx(aa,{children:"Sunting Profil"}),a.jsx(ea,{children:a.jsxs(O,{mx:"auto",spacing:"2",maxW:"container.sm",children:[a.jsxs(E,{isInvalid:!!o.name&&b.name,children:[a.jsx(w,{children:"Nama"}),a.jsx(Ma,{id:"name",name:"name",placeholder:"Misal : Suparna",onChange:m,onBlur:f,value:j.name}),a.jsx(T,{children:o.name})]}),a.jsxs(E,{isInvalid:!!o.address&&b.address,children:[a.jsx(w,{children:"Alamat"}),a.jsx(A,{id:"address",name:"address",placeholder:"Masukkan Alamat Tempat tinggal Pengguna",onChange:m,onBlur:f,value:j.address}),a.jsx(T,{children:o.address})]}),a.jsxs(E,{isInvalid:!!o.description&&b.description,children:[a.jsx(w,{children:"Description"}),a.jsx(A,{id:"description",name:"description",placeholder:"Opsional",onChange:m,onBlur:f,value:j.description}),a.jsx(T,{children:o.description})]})]})}),a.jsxs(sa,{children:[a.jsx(S,{variant:"ghost",onClick:n,children:"Batal"}),a.jsx(S,{isLoading:D,type:"submit",colorScheme:"blue",ml:3,children:"Submit"})]})]})})]})]})}function he(){const{id:d}=na(),{user:s,roleIs:c}=H(),{data:e,mutate:l,error:n}=oa(`/companies/${d}`,ia);if(n)throw n;return e?a.jsxs(t,{children:[a.jsx(xa,{Icon:a.jsx(ra,{}),text:"Detail Perusahaan"}),a.jsxs(V,{mt:"6",px:"0",maxW:"container.md",children:[a.jsxs(r,{justify:"space-between",align:"start",wrap:"wrap",spacing:"6",children:[a.jsxs(t,{children:[a.jsx(F,{fontSize:"3xl",children:e.name}),a.jsxs(r,{mt:"2",children:[a.jsx(ga,{icon:La,colorScheme:"blue",children:`Dibuat pada ${ba(e.createdAt)}`}),a.jsx(da,{value:e.type})]}),["admin","gov"].includes(s.role)&&a.jsx(fa,{mt:"3",data:e.manager,label:"manager"})]}),a.jsx(ca,{}),a.jsxs(r,{children:[a.jsx(la,{alignSelf:"start",companyId:e.companyId}),c(["admin","manager"])&&a.jsx($a,{data:e,mutate:l,colorScheme:"blue",alignSelf:"start",leftIcon:a.jsx(Ua,{size:"16"}),children:"Sunting Perusahaan"})]})]}),a.jsx(B,{IconEl:ua,children:"Alamat"}),a.jsx(M,{children:e.address}),a.jsx(B,{IconEl:pa,children:"Deskripsi Perusahaan"}),a.jsx(M,{children:e.description}),a.jsx(Wa,{data:e,mutate:l}),c(["admin","manager"])&&a.jsxs(a.Fragment,{children:[a.jsx(B,{IconEl:ma,children:"Lainnya"}),a.jsx(ha,{resource:"Perusahaan",name:e.name,colorScheme:"red",deleteApiUrl:"/companies/"+e.companyId,redirectPath:"/companies"})]})]})]}):a.jsx(ta,{})}export{he as default};
