import{c as Ce,f as V,d as ke,o as ve,j as e,b as H,a as _,N as P,r as f,U as l,H as O,I as F,Y as h,a0 as S,V as Me,M as te,W as X,G as Te}from"./font-5Mxaz-3e.js";import{b as De,a as ze,D as Be}from"./DeleteReourceButton-BYb2czpq.js";import{J as re,K as Pe,B as Ne,w as oe,N as Le,T as N,O as ie,P as le,Q as ce,m as L,e as de,u as me,V as we,W as Ee,X as Fe,d as Ue,o as R,M as Ae,g as $e,h as We,i as Ve,j as He,k as _e,b as Oe,f as Re,L as Ge,Y as Ke,Z as qe,D as Je,x as Ye}from"./app-DYChiyhM.js";import{S as j}from"./SectionTitle-BFvQ7AOU.js";import{T as Qe}from"./TagWithIcon-D2AD1She.js";import{E as Xe,C as Ze}from"./EditInMapInputGroup-B-T4rU0R.js";import{t as G,a as ue}from"./dateFormating-uitVsAGu.js";import{u as w,a as ea,c as aa}from"./common.utils-28SvxYlP.js";import{I as he}from"./IconTrash-CjGmnbs0.js";import{I as pe}from"./IconExternalLink-DW-fAtDQ.js";import{I as xe,B as y,F as M,c as Z}from"./logo-white-CsuGh6aO.js";import{c as sa,U as ee,d as ae}from"./MyLineChart-BXIv1Ay6.js";import{I as U}from"./IconInfoCircle-Bc7REsKt.js";import{G as na}from"./chunk-JARCRF6W-CSqiEFzw.js";import{T as ta,a as ra,b as oa}from"./chunk-4YMKQ5D4-DA2V1YAZ.js";import{T as ia,a as la}from"./chunk-IAXSQ4X2-D5Bt3YnL.js";import{I as ca}from"./IconUsersGroup-DRocYACT.js";import{L as da}from"./chunk-K7XRJ7NL-DKYEMZRA.js";import{n as ma,d as ua,b as ha}from"./validator.utils-CftwUUTS.js";import{u as pa,c as xa,f as ga,F as T,b as D}from"./index.esm-RWPM2pE6.js";import{T as se}from"./chunk-4IH3O7BJ-Ckr7B5YK.js";import{M as ja}from"./index-BbXyb5rb.js";import{I as ba}from"./IconCalendar-B1mhmU7N.js";import{I as fa}from"./IconEdit-KqgxMpic.js";import{D as ne}from"./logo-Byq_-Epn.js";import"./GMapsButton-CNOYrNRq.js";var[Sa,ge]=Ce({name:"StatStylesContext",errorMessage:`useStatStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Stat />" `}),A=V(function(n,c){const r=ke("Stat",n),a={position:"relative",flex:"1 1 0%",...r.container},{className:t,children:o,...u}=ve(n);return e.jsx(Sa,{value:r,children:e.jsx(H.div,{ref:c,...u,className:_("chakra-stat",t),__css:a,children:e.jsx("dl",{children:o})})})});A.displayName="Stat";var $=V(function(n,c){const r=ge();return e.jsx(H.dt,{ref:c,...n,className:_("chakra-stat__label",n.className),__css:r.label})});$.displayName="StatLabel";var W=V(function(n,c){const r=ge();return e.jsx(H.dd,{ref:c,...n,className:_("chakra-stat__number",n.className),__css:{...r.number,fontFeatureSettings:"pnum",fontVariantNumeric:"proportional-nums"}})});W.displayName="StatNumber";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ya=P("outline","chart-bubble","IconChartBubble",[["path",{d:"M6 16m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-0"}],["path",{d:"M16 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14.5 7.5m-4.5 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 1 0 -9 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ia=P("outline","inner-shadow-top","IconInnerShadowTop",[["path",{d:"M5.636 5.636a9 9 0 1 0 12.728 12.728a9 9 0 0 0 -12.728 -12.728z",key:"svg-0"}],["path",{d:"M16.243 7.757a6 6 0 0 0 -8.486 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ca=P("outline","map-check","IconMapCheck",[["path",{d:"M11 18l-2 -1l-6 3v-13l6 -3l6 3l6 -3v9",key:"svg-0"}],["path",{d:"M9 4v13",key:"svg-1"}],["path",{d:"M15 7v8",key:"svg-2"}],["path",{d:"M15 19l2 2l4 -4",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ka=P("outline","trending-up","IconTrendingUp",[["path",{d:"M3 17l6 -6l4 4l8 -8",key:"svg-0"}],["path",{d:"M14 7l7 0l0 7",key:"svg-1"}]]);const z=ce();function va({data:i,mutate:n}){let{nodeId:c,countCompanySubscribtion:r}=i;const a=re(),t=`/nodes/${c}/companies`,o=w(),u=s=>{a({title:"Hapus Perusahaan",message:"Hapus pengguna dari daftar pelanggan node "+i.name,confirmButtonColor:"red",onConfirm:async()=>L.delete(`${t}/${s}`).then(()=>{de(d=>typeof d=="string"&&d.startsWith(t)),n(),o.success("Berhasil menghapus subscription pengguna")}).catch(()=>{o.error("Gagal menghapus subscription pengguna")})})},m=f.useMemo(()=>[z.accessor("name",{header:"Nama",cell:s=>{const{color:d,icon:p}=Pe[s.row.original.type];return e.jsxs(l,{spacing:"3",children:[e.jsx(O,{rounded:"md",border:"2px solid",borderColor:d+".200",color:d+".500",p:"2",children:e.jsx(F,{as:p,boxSize:"18px"})}),e.jsx(h,{children:s.getValue()})]})},meta:{sortable:!0}}),z.accessor("type",{header:"Jenis ",cell:s=>e.jsx(Ne,{value:s.getValue()}),meta:{sortable:!0}}),z.accessor("joinedAt",{header:"Berlangganan sejak",cell:s=>G(s.getValue()),meta:{sortable:!0}}),z.accessor("companyId",{header:"Aksi",cell:s=>e.jsxs(l,{children:[e.jsx(xe,{size:"sm",colorScheme:"red",icon:e.jsx(he,{size:"16"}),"aria-label":"Hapus",onClick:()=>u(s.getValue())}),e.jsx(oe,{to:"/companies/"+s.getValue(),children:e.jsx(y,{colorScheme:"blue",size:"sm",leftIcon:e.jsx(pe,{size:"16"}),children:"Lihat Perusahaan"})})]})})],[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{IconEl:Le,children:["Daftar perusahaan yang mensubscribe",e.jsx(N,{colorScheme:"blue",ml:"2",children:r||0})]}),!!r&&e.jsx(l,{mt:"4",justify:"end",children:e.jsx(ie,{w:"350px",rounded:"md",bg:"white",placeholder:"Cari Perusahaan",_onSubmit:null})}),e.jsx(le,{mt:"4",apiUrl:t,columns:m,emptyMsg:["Belum ada Perusahaan"]})]})}function Ma({data:i,lastDataSent:n}){const{user:c}=me(),r=[{key:"pm25",name:"PM2.5",gasType:"PM2.5",unit:ee},{key:"pm100",name:"PM10",gasType:"PM10",unit:ee},{key:"co2",name:"Karbon dioksida",gasType:"CO2",unit:ae},{key:"ch4",name:"Metana",gasType:"CH4",unit:ae}];return e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:we,children:"Data terakhir dikirim"}),n?e.jsxs(S,{children:[e.jsxs(l,{my:"3",children:[e.jsx(Ia,{size:"20"}),e.jsx(h,{fontWeight:"600",children:"Data Terbaru"}),e.jsx(N,{children:ue(n)})]}),e.jsx(na,{gap:"2",templateColumns:"repeat(auto-fit, minmax(150px, 1fr))",children:r.map(({name:a,key:t,unit:o})=>e.jsxs(S,{flex:"1 0 0px",py:"2",px:"4",border:"2px solid",borderColor:"gray.200",rounded:"md",children:[e.jsx(h,{fontWeight:"600",children:a}),e.jsxs(l,{align:"baseline",children:[e.jsx(h,{fontWeight:"600",fontSize:"xl",children:i&&i[0][t]}),e.jsx(h,{fontSize:"sm",children:o})]})]},t))}),e.jsxs(l,{mb:"2",mt:"4",children:[e.jsx(ka,{size:"20"}),e.jsx(h,{fontWeight:"600",children:"Tren 24 jam terakhir"})]}),e.jsxs(ta,{isLazy:!0,size:"sm",children:[e.jsx(ia,{children:r.map(({name:a,key:t})=>e.jsx(la,{children:a},t))}),e.jsx(ra,{children:r.map(({key:a,gasType:t})=>e.jsx(oa,{px:"0",children:e.jsx(S,{w:"full",h:"280px",as:i?void 0:Ee,children:!!i&&e.jsx(sa,{data:i,simple:!0,gasType:t,dataKeyTypeAndFunc:{func:o=>({value:o[a]})}})})},a))})]}),c.role!=="regular"&&e.jsxs(l,{children:[e.jsx(U,{size:"18"}),e.jsxs(h,{children:["Pergi ke menu ",e.jsx("strong",{children:"Data"})," untuk mengunduh data"]})]})]}):e.jsx(O,{w:"full",py:"5",children:e.jsx(h,{fontWeight:"600",color:"gray.500",fontSize:"xl",children:"Node Belum Pernah Mengirim Data"})})]})}const B=ce();function Ta({data:i,mutate:n}){let{nodeId:c,countUserSubscription:r}=i;const a=re(),t=w(),o=`/nodes/${c}/users`,u=s=>{a({title:"Hapus Pengguna",message:"Hapus pengguna dari daftar pelanggan node "+i.name,confirmButtonColor:"red",onConfirm:async()=>L.delete(`${o}/${s}`).then(()=>{de(d=>typeof d=="string"&&d.startsWith(o)),n(),t.success("Berhasil menghapus subscription pengguna")}).catch(()=>{t.error("Gagal menghapus subscription pengguna")})})},m=f.useMemo(()=>[B.accessor("name",{header:"Nama",cell:s=>e.jsx(Fe,{name:s.getValue()}),meta:{sortable:!0}}),B.accessor("phone",{header:"Telepon",cell:s=>e.jsx(da,{href:"tel:+62"+s.getValue(),children:s.getValue()})}),B.accessor("joinedAt",{header:"Berlangganan sejak",cell:s=>G(s.getValue()),meta:{sortable:!0}}),B.accessor("userId",{header:"Aksi",cell:s=>e.jsxs(l,{children:[e.jsx(xe,{size:"sm",colorScheme:"red",icon:e.jsx(he,{size:"16"}),"aria-label":"Hapus",onClick:()=>u(s.getValue())}),e.jsx(oe,{to:"/users/"+s.getValue(),children:e.jsx(y,{colorScheme:"blue",size:"sm",leftIcon:e.jsx(pe,{size:"16"}),children:"Lihat Pengguna"})})]})})],[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{IconEl:ca,children:["Daftar pengguna yang mensubscribe",e.jsx(N,{colorScheme:"blue",ml:"2",children:r||0})]}),!!r&&e.jsx(l,{mt:"4",justify:"end",children:e.jsx(ie,{w:"350px",rounded:"md",bg:"white",placeholder:"Cari Pengguna",_onSubmit:null})}),e.jsx(le,{mt:"4",apiUrl:o,columns:m,emptyMsg:["Belum ada Pengguna"]})]})}function Da({data:i,mutate:n,...c}){const{isOpen:r,onOpen:a,onClose:t}=Ue(),o=w(),{name:u,description:m,address:s,instalationDate:d}=i,p={name:u,description:m,address:s,instalationDate:d},{id:x}=R(),je=`${te}/nodes/${x}`,{handleChange:I,values:C,errors:g,setFieldError:be,handleSubmit:fe,handleBlur:k,resetForm:Se,touched:v,isSubmitting:ye,setSubmitting:K}=pa({initialValues:p,validationSchema:xa().shape({name:ma.required("Wajib diisi"),description:ua.required("Wajib diisi"),address:ha.required("Wajib diisi"),instalationDate:ga().nullable()}),onSubmit:q=>{ea(q);const E=aa(p,q);if(Object.keys(E).length===0){o.opss("Belum ada yang disunting"),K(!1);return}L.patch(je,{...E}).then(()=>{o.success("Berhasil Memperharui data"),n(b=>b&&{...b,...E}),t()}).catch(b=>{var Y,Q;((Y=b.response)==null?void 0:Y.status)!==400&&o.error("Gagal Memperharui data");const[Ie,J]=((Q=b.response)==null?void 0:Q.data.message)||[];be(Ie,J),o.error(J||"Ada yang salah")}).finally(()=>{K(!1)})}});return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:a,...c}),e.jsxs(Ae,{size:"lg",autoFocus:!1,isOpen:r,onClose:t,closeOnOverlayClick:!1,children:[e.jsx($e,{}),e.jsx(We,{children:e.jsxs("form",{onSubmit:fe,className:"my-form",children:[e.jsx(Ve,{children:"Sunting Profil"}),e.jsx(He,{children:e.jsxs(Me,{mx:"auto",spacing:"2",maxW:"container.sm",children:[e.jsxs(M,{isInvalid:!!g.name&&v.name,children:[e.jsx(T,{children:"Nama"}),e.jsx(Z,{id:"name",name:"name",placeholder:"Misal : Suparna",onChange:I,onBlur:k,value:C.name}),e.jsx(D,{children:g.name})]}),e.jsxs(M,{isInvalid:!!g.description&&v.description,children:[e.jsx(T,{children:"Description"}),e.jsx(se,{id:"description",name:"description",placeholder:"Opsional",onChange:I,onBlur:k,value:C.description}),e.jsx(D,{children:g.description})]}),e.jsxs(M,{isInvalid:!!g.address&&v.address,children:[e.jsx(T,{children:"Alamat"}),e.jsx(se,{id:"address",name:"address",placeholder:"Opsional",onChange:I,onBlur:k,value:C.address}),e.jsx(D,{children:g.address})]}),e.jsxs(M,{isInvalid:!!g.instalationDate&&v.instalationDate,children:[e.jsx(T,{children:"Tanggal Instalasi"}),e.jsx(Z,{id:"instalationDate",name:"instalationDate",type:"date",onChange:I,onBlur:k,value:C.instalationDate}),e.jsx(D,{children:g.instalationDate})]})]})}),e.jsxs(_e,{children:[e.jsx(y,{variant:"ghost",onClick:()=>{Se(),t()},children:"Batal"}),e.jsx(y,{isLoading:ye,type:"submit",colorScheme:"blue",ml:3,children:"Submit"})]})]})})]})]})}function za({canEdit:i,data:n,mutate:c}){const[r,a]=f.useState(n.coordinate),[t,o]=f.useState(!1),[u,m]=f.useState(!1),{id:s}=R(),d=w(),p=async()=>{o(!0);const x=`${te}/nodes/${s}`;L.patch(x,{coordinate:r}).then(()=>{d.success("Lokasi Perusahaan berhasil diperbarui"),c({...n,coordinate:r})}).catch(()=>{d.error("Lokasi Perusahaan gagal diperbarui")}).finally(()=>{m(!1),o(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:Ca,children:"Letak Node"}),e.jsx(Xe,{canEdit:i,coordinate:n.coordinate,isEditingState:[u,m],editedCoordinateState:[r,a],isSubmiting:t,handleSubmitEditedCoordinate:p}),e.jsx(ja,{mt:"4",data:[n],outline:u?"3px solid":"",outlineColor:"orange.300",isEditing:u?{coordinate:r||n.coordinate,onChange:x=>a([x.lat,x.lng])}:void 0})]})}function ss(){var p,x;const{id:i}=R(),{roleIs:n,user:c}=me(),r=`/nodes/${i}`,{data:a,mutate:t,error:o}=Oe(r,Re);if(o)throw o;if(!a)return e.jsx(Ge,{});const u=!!a.owner,m=Ke[a.isUptodate?"active":"nonactive"],s=qe[a.companyId?"private":"public"],d=n("admin")||n("manager")&&((p=a.owner)==null?void 0:p.managedBy)==c.userId;return e.jsxs(S,{children:[e.jsx(l,{w:"full",spacing:"4",align:"start",children:e.jsxs(l,{spacing:"3",children:[e.jsx(O,{boxSize:"30px",boxShadow:"xs",bg:"gray.100",rounded:"md",p:"1",children:e.jsx(Je,{})}),e.jsx(X,{fontSize:"xl",fontWeight:"600",children:"Detail Node"})]})}),e.jsxs(Te,{mt:"6",maxW:"container.md",px:"0",children:[e.jsxs(l,{spacing:"4",justify:"space-between",wrap:"wrap",children:[e.jsxs(S,{children:[e.jsx(X,{fontSize:"3xl",children:a.name}),e.jsx(l,{mt:"2",children:!!a.instalationDate&&e.jsx(Qe,{icon:ba,colorScheme:"orange",children:`Node dipasang pada ${G(a.instalationDate)}`})}),a.owner&&e.jsx(Ze,{mt:"3",data:a.owner})]}),d&&e.jsx(Da,{data:a,mutate:t,colorScheme:"blue",alignSelf:"start",leftIcon:e.jsx(fa,{size:"16"}),children:"Sunting Profil"})]}),e.jsx(j,{IconEl:De,children:"Deskripsi Node"}),e.jsx(h,{children:a.description}),!u&&e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:ze,children:"Alamat"}),e.jsx(h,{children:a.address})]}),e.jsx(j,{IconEl:ya,children:"Status"}),e.jsxs(l,{mt:"3",spacing:"4",wrap:"wrap",children:[e.jsxs(A,{flex:"1 0 250px",bg:m.color+".50",p:"4",rounded:"md",border:"2px solid",borderColor:m.color+".400",children:[e.jsx($,{children:"Status"}),e.jsxs(l,{spacing:"2",my:"1",children:[e.jsx(F,{as:m.icon,boxSize:"28px"}),e.jsx(W,{textTransform:"capitalize",children:m.name})]}),e.jsxs(l,{children:[e.jsx(U,{size:"16"}),e.jsx(h,{fontSize:"sm",children:m.note})]}),e.jsx(ne,{borderColor:m.color,mt:"3",mb:"2"}),e.jsxs(h,{fontSize:"sm",children:["Terakhir data diperbarui"," ",ue(a.lastDataSent)]})]}),e.jsxs(A,{flex:"1 0 250px",bg:s.color+".50",p:"4",rounded:"md",border:"2px solid",borderColor:s.color+".400",children:[e.jsx($,{children:"Kepemilikan"}),e.jsxs(l,{spacing:"2",my:"1",children:[e.jsx(F,{as:s.icon,boxSize:"28px"}),e.jsx(W,{textTransform:"capitalize",children:s.name})]}),e.jsxs(l,{children:[e.jsx(U,{size:"16"}),e.jsx(h,{fontSize:"sm",children:s.note})]}),e.jsx(ne,{borderColor:s.color,mt:"3",mb:"2"}),e.jsxs(l,{fontSize:"sm",align:"baseline",children:[e.jsx(h,{children:"Dikelola oleh: "}),e.jsx(N,{size:"sm",fontSize:"xs",children:((x=a.owner)==null?void 0:x.name)||"Admin"})]})]})]}),!u&&e.jsx(za,{canEdit:d,data:a,mutate:t}),!a.companyId&&n("admin")&&e.jsxs(e.Fragment,{children:[e.jsx(va,{data:a,mutate:t}),e.jsx(Ta,{data:a,mutate:t})]}),e.jsx(Ma,{data:a.dataLogs,lastDataSent:a.lastDataSent,mutate:t}),d&&e.jsxs(e.Fragment,{children:[e.jsx(j,{IconEl:Ye,children:"Lainnya"}),e.jsx(Be,{resource:"Node",name:a.name,colorScheme:"red",deleteApiUrl:"/nodes/"+a.nodeId,redirectPath:"/nodes"})]})]})]})}export{ss as default};
