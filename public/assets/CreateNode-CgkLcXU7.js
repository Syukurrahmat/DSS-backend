import{r as k,j as a,L as y,M as K,T as d,F as W,N as Q,V as X}from"./createReactComponent-WPW12zrK.js";import{B as D}from"./BigAlert-gHJNWQgg.js";import{u as Y,s as aa,p as ea,Z as sa,m as ia,C as na,F as ta,_ as oa,w as ra}from"./app-B_fwFRhX.js";import{F as da}from"./FormMapPicker-DwGi33-0.js";import{R as g}from"./RequiredIndicator-BSTyY86i.js";import{S as ca}from"./Sdd-xczc1ILT.js";import{u as la,a as ma}from"./common.utils-BDtzQ6xa.js";import{n as q,d as V,b as pa}from"./validator.utils-C_TaQQBu.js";import{u as ua,F as c,b,c as E,f as $,e as ha,d as xa}from"./index.esm-BStM4cIJ.js";import{I as ja}from"./IconInfoCircle-De_dvTL1.js";import{T as ga,a as ba,b as fa}from"./chunk-4YMKQ5D4-BmSsW2IV.js";import{T as Na,a as Ia}from"./chunk-IAXSQ4X2-BB3sunCX.js";import{D as ka,H as M}from"./icon-BvDSS9q3.js";import{F as l,c as w,B as ya}from"./icon-white-BiuxQ1Ek.js";import{T as L}from"./chunk-4IH3O7BJ-s5k9DqCt.js";import"./IconCirclePlus-Fzp5W_0t.js";import"./index-CQt-qjNZ.js";import"./dateFormating-CkDZtFMB.js";import"./index.tags-CXW0_EVK.js";import"./TagWithIcon-mGaDAwMD.js";const Sa=E().shape({name:q.required("Wajib diisi"),description:V.required("Wajib diisi"),address:pa.required("Wajib diisi"),instalationDate:$().nullable(),coordinate:ha().test("","Anda Belum menentukan titik koordinat",m=>m&&m.filter(f=>f).length==2)}),va=E().shape({companyId:xa().required("Wajib diisi"),name:q.required("Wajib diisi"),description:V.required("Wajib diisi"),instalationDate:$().nullable()});function Oa(){var T;const{roleIs:m}=Y(),f=aa(),z=la(),S=!ea("/nodes/create"),v=!S&&m("admin"),[o,H]=k.useState(v?0:1),[R,N]=k.useState(),e=(T=f.state)==null?void 0:T.company;if(S&&!e)return a.jsx(sa,{to:"..",relative:"path"});const U=o?va:Sa,{handleChange:p,handleBlur:u,values:_,touched:h,status:r,setStatus:B,setFieldValue:I,setFieldError:O,resetForm:C,setSubmitting:Z,isSubmitting:G,errors:i,handleSubmit:J}=ua({initialValues:{name:"",description:"",address:"",instalationDate:"",coordinate:[NaN,NaN],companyId:(e==null?void 0:e.companyId)||NaN},validationSchema:U,onSubmit:s=>{let t={};if(o){const{coordinate:n,address:x,...j}=s;t=j}else{const{companyId:n,...x}=s;t=x}ia.post("/nodes",ma(t)).then(({data:n})=>{B({created:!0,nodeId:n.data.nodeId})}).catch(n=>{var A,P;if(((A=n.response)==null?void 0:A.status)!==400)return B({created:!1});const[x,j]=((P=n.response)==null?void 0:P.data.message)||[];O(x,j),z.error(j||"Ada yang salah")}).finally(()=>Z(!1))}});k.useEffect(()=>{I("companyId",(e==null?void 0:e.companyId)||NaN)},[]);const F=[{icon:oa,name:"Node Publik",note:"Membuat node Publik yang dapat digunakan oeh semua user"},{icon:ra,name:"Node Private",note:"Membuat node private hanya suatu perusahaan spesifik"}];return a.jsxs(y,{children:[a.jsx(K,{size:"lg",children:"Buat Node"}),a.jsx(d,{children:"Buat node untuk menambah akurasi sistem"}),a.jsxs(W,{maxW:"container.md",mt:"4",children:[r===void 0&&v&&a.jsxs(ga,{index:o,onChange:H,variant:"soft-rounded",colorScheme:"blue",children:[a.jsx(Na,{gap:"4",children:F.map(({name:s,icon:t},n)=>a.jsxs(Ia,{rounded:"md",children:[a.jsx(Q,{as:t,boxSize:"20px"}),a.jsx(d,{ml:"2",children:s})]},n))}),a.jsx(ka,{mt:"2",border:"1px solid",borderColor:"gray.400"}),a.jsx(ba,{children:F.map(({note:s},t)=>a.jsxs(fa,{px:"0",as:M,spacing:"1",children:[a.jsx(ja,{size:"20"}),a.jsx(d,{ml:"2",children:s})]},t))})]}),r===void 0?a.jsx(W,{maxW:"container.sm",children:a.jsx("form",{onSubmit:J,className:"my-form",children:a.jsxs(X,{mx:"auto",spacing:"2",maxW:"container.sm",children:[o&&(e?a.jsxs(y,{alignSelf:"start",children:[a.jsx(d,{fontWeight:"600",children:"Buat Node Untuk Perusahaan"}),a.jsxs(M,{mt:"2",spacing:"3",shadow:"xs",p:"3",bg:"white",rounded:"md",children:[a.jsx(na,{type:e.type,size:"24px"}),a.jsxs(y,{children:[a.jsx(d,{fontWeight:"600",pr:"2",children:e.name}),a.jsx(d,{children:ta[e.type].name})]})]})]}):a.jsxs(l,{children:[a.jsxs(c,{children:["Pilih Perusahaan ",a.jsx(g,{})]}),a.jsx(ca,{_value:R,_onChange:s=>{N(s),I("companyId",s==null?void 0:s.companyId)}}),a.jsx(b,{children:i.companyId})]})),a.jsxs(l,{isInvalid:!!i.name&&h.name,children:[a.jsxs(c,{children:["Nama Node ",a.jsx(g,{})]}),a.jsx(w,{id:"name",name:"name",placeholder:"Misal : Belakang rumah pak Subegja",onChange:p,onBlur:u}),a.jsx(b,{children:i.name})]}),a.jsxs(l,{isInvalid:!!i.description&&h.description,children:[a.jsxs(c,{children:["Deskripsi node ",a.jsx(g,{})]}),a.jsx(L,{id:"description",name:"description",placeholder:"Masukkan deskripsi node, singkat saja",onChange:p,onBlur:u}),a.jsx(b,{children:i.description})]}),!o&&a.jsx(a.Fragment,{children:a.jsxs(l,{isInvalid:!!i.address&&h.address,children:[a.jsxs(c,{children:["Alamat node ",a.jsx(g,{})]}),a.jsx(L,{id:"address",name:"address",placeholder:"Masukkan Alamat Node berada",onChange:p,onBlur:u}),a.jsx(b,{children:i.address})]})}),a.jsxs(l,{children:[a.jsx(c,{children:"Tanggal Instalasi"}),a.jsx(w,{w:"fit-content",type:"date",id:"instalationDate",name:"instalationDate",onChange:p,onBlur:u})]}),!o&&a.jsx(da,{errors:i.coordinate,touched:h.coordinate,values:_.coordinate,setFieldValue:I}),a.jsx(ya,{isLoading:G,w:"full",mt:"4",colorScheme:"green",type:"submit",children:"Buat Node"})]})})}):r.created?a.jsx(D,{status:"success",title:"Node berhasil dibuat",description:"Node siap untuk digunakan dalam sistem Anda",onCreateAgain:()=>{C(),N(void 0)},itemName:"node",detailPageURL:`/nodes/${r==null?void 0:r.nodeId}`}):a.jsx(D,{status:"warning",title:"Node gagal didaftarkan",description:"Ada yang salah. Hubungi Administrator",onCreateAgain:()=>{C(),N(void 0)}})]})]})}export{Oa as default};
