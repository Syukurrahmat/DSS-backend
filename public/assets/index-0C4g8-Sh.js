import{N as L,r as B,j as e,V as Y,U as p,Y as k,a0 as v,R as q,W as z}from"./font-5Mxaz-3e.js";import{u as R,d as N,l,m as V,e as H,M as U,g as $,h as G,i as J,j as _,a as Q,a5 as X,k as Z,b as ee,f as se,a6 as ae,a7 as te,T as ne,W as ie,F as oe}from"./app-DYChiyhM.js";import{C as re,S as le}from"./CardEventLog-DwnJ6tz6.js";import{R as M}from"./RequiredIndicator-CZ0U0vjk.js";import{u as ce,a as de}from"./common.utils-28SvxYlP.js";import{n as he,d as me}from"./validator.utils-CftwUUTS.js";import{c as pe,a as E,u as ue,F as D,b as y}from"./index.esm-RWPM2pE6.js";import{I as xe}from"./IconPlus-CSH41dZv.js";import{B as T,F as C,c as I}from"./logo-white-CsuGh6aO.js";import{M as je}from"./chunk-4FCEGNGT-BMu37YYo.js";import{T as ge}from"./chunk-4IH3O7BJ-Ckr7B5YK.js";import{S as F}from"./chunk-VTV6N5LE-B0POHVpf.js";import{S as fe}from"./SectionTitle-BFvQ7AOU.js";import{E as De}from"./EventCalendar-BzwLwHQ9.js";import{I as ye}from"./IconNotebookOff-CmU2kgzp.js";import"./logo-Byq_-Epn.js";import"./dateFormating-uitVsAGu.js";import"./IconMapPin-DDszNiav.js";import"./IconTrash-CjGmnbs0.js";import"./IconEdit-KqgxMpic.js";import"./IconCalendar-B1mhmU7N.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ce=L("outline","checklist","IconChecklist",[["path",{d:"M9.615 20h-2.615a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8",key:"svg-0"}],["path",{d:"M14 19l2 2l4 -4",key:"svg-1"}],["path",{d:"M9 8h4",key:"svg-2"}],["path",{d:"M9 12h2",key:"svg-3"}]]);const ke=pe().shape({name:he.required("Wajib Diisi"),description:me.required("Wajib Diisi"),type:E().required("Wajib Diisi"),status:E().required("Wajib Diisi"),location:E().nullable()});function be(){var K,O;const{user:u}=R(),s=(O=(K=u.view)==null?void 0:K.company)==null?void 0:O.companyId,{isOpen:c,onOpen:d,onClose:r}=N(),o=ce(),[t,S]=B.useState(!1),[x,j]=B.useState(!1),{handleChange:h,handleBlur:g,isSubmitting:A,values:n,setFieldValue:b,resetForm:w,touched:f,errors:i,handleSubmit:P}=ue({initialValues:{name:"",description:"",status:"inProgress",type:"production",location:"",startDate:l().format("YYYY-MM-DD"),endDate:l().format("YYYY-MM-DD"),isCompleted:!1},validationSchema:ke,onReset:()=>{S(!1),j(!1)},onSubmit:async a=>{a.endDate=t?a.startDate:x?null:a.endDate;const m=`/companies/${s}/events`;V.post(m,de(a)).then(()=>{o.success("Kegiatan berhasil ditambahkan"),H(W=>typeof W=="string"&&W.startsWith(m)),r(),w()}).catch(()=>{o.error("Kegiatan gagal ditambahkan")})}});return B.useEffect(()=>{l(n.endDate).isBefore(l(n.startDate))&&b("endDate",n.startDate)},[n.startDate]),B.useEffect(()=>{l(n.endDate).isAfter(l())&&b("isCompleted",!1)},[n.endDate]),e.jsxs(e.Fragment,{children:[e.jsx(T,{leftIcon:e.jsx(xe,{size:"20px"}),colorScheme:"blue",children:"Tambah Catatan",onClick:d}),e.jsx(U,{size:"2xl",isOpen:c,onClose:r,scrollBehavior:"inside",closeOnEsc:!1,onCloseComplete:w,children:e.jsxs("form",{onSubmit:P,children:[e.jsx($,{}),e.jsxs(G,{children:[e.jsx(J,{borderBottom:"1px solid",borderColor:"gray.200",children:"Catat Kegiatan"}),e.jsx(je,{}),e.jsx(_,{children:e.jsxs(Y,{mx:"auto",spacing:"2",maxW:"container.sm",my:"4",children:[e.jsxs(C,{isInvalid:!!i.name&&f.name,children:[e.jsxs(D,{children:["Nama Kegiatan ",e.jsx(M,{})]}),e.jsx(I,{id:"name",name:"name",placeholder:"Misal : produksi tahu ",onChange:h,onBlur:g}),e.jsx(y,{children:i.name})]}),e.jsxs(C,{isInvalid:!!i.description&&f.description,children:[e.jsxs(D,{children:["Deskripsi Kegiatan ",e.jsx(M,{})]}),e.jsx(ge,{id:"description",name:"description",placeholder:"Tulis deskripsi kegiatan, singkat saja",onChange:h,onBlur:g}),e.jsx(y,{children:i.description})]}),e.jsxs(C,{isInvalid:!!i.location&&f.location,children:[e.jsx(D,{children:"Tempat Kegiatan"}),e.jsx(I,{id:"location",name:"location",placeholder:"Misal : Gudang ",onChange:h,onBlur:g}),e.jsx(y,{children:i.location})]}),e.jsxs(C,{isInvalid:!!i.type&&f.type,children:[e.jsxs(D,{children:["Jenis Kegiatan ",e.jsx(M,{})]}),e.jsx(Q,{id:"type",name:"type",onChange:h,onBlur:g,bg:"white",children:Object.entries(X).map(([a,m])=>e.jsx("option",{value:a,children:m.name},a))}),e.jsx(y,{children:i.type})]}),e.jsxs(p,{w:"full",align:"start",children:[e.jsxs(C,{isInvalid:!!i.startDate&&f.startDate,children:[e.jsxs(D,{children:["Tanggal dimulai ",e.jsx(M,{})]}),e.jsx(I,{id:"startDate",name:"startDate",type:"date",placeholder:"Misal : produksi tahu",value:n.startDate,onChange:h,onBlur:g}),e.jsxs(p,{as:"label",mt:"2",align:"center",cursor:"pointer",w:"fit-content",children:[e.jsx(F,{isChecked:t,onChange:a=>{const{checked:m}=a.target;S(m),m&&b("endDate",n.startDate)}}),e.jsx(k,{children:"Kegiatan hanya sehari"})]}),e.jsx(y,{children:i.startDate})]}),e.jsxs(C,{isInvalid:!!i.endDate&&f.endDate,children:[e.jsx(D,{children:"Tanggal berakhir"}),e.jsx(I,{id:"endDate",name:"endDate",type:"date",min:n.startDate,isDisabled:x||t,value:x?"":n.endDate||"",onChange:a=>b("endDate",a.target.value),onBlur:g}),e.jsx(p,{mt:"2",spacing:"4",children:e.jsxs(p,{as:"label",cursor:"pointer",w:"fit-content",children:[e.jsx(F,{isChecked:x&&!t,isDisabled:t||n.isCompleted,onChange:a=>j(a.target.checked)}),e.jsx(k,{color:t?"gray.400":"inherit",children:"Atur nanti"})]})}),e.jsx(y,{children:i.endDate})]})]}),e.jsxs(p,{alignSelf:"start",as:"label",cursor:"pointer",w:"fit-content",children:[e.jsx(F,{isChecked:n.isCompleted,isDisabled:l(n.endDate).startOf("d").isAfter(l()),onChange:a=>{b("isCompleted",a.target.checked)}}),e.jsx(k,{children:"Kegiatan sudah selesai"})]})]})}),e.jsxs(Z,{borderTop:"1px solid",borderColor:"gray.200",children:[e.jsx(T,{onClick:()=>{w(),r()},children:"Batal"}),e.jsx(T,{colorScheme:"blue",ml:3,type:"submit",isLoading:A,children:"Kirim"})]})]})]})})]})}function ve({companyId:u}){const{data:s}=ee(u?`/companies/${u}/events/overview`:null,se),c=[{title:"Kegiatan Berlangsung",icon:ae,count:s==null?void 0:s.inProgress.count,events:s==null?void 0:s.inProgress.events},{title:"Kegiatan Mendatang",icon:te,count:s==null?void 0:s.upcoming.count,events:s==null?void 0:s.upcoming.events},{title:"Kegiatan Selesai",icon:Ce,count:s==null?void 0:s.complete.count,events:s==null?void 0:s.complete.events,more:!0}];return e.jsx(v,{children:c.map(({title:d,icon:r,count:o,events:t,more:S},x)=>e.jsxs(q.Fragment,{children:[e.jsxs(fe,{IconEl:r,children:[d,!!o&&e.jsx(ne,{children:o,ml:"2",colorScheme:"blue"})]}),e.jsx(Y,{align:"stretch",children:t?t.length?e.jsxs(e.Fragment,{children:[t.map(j=>e.jsx(re,{event:j},j.eventLogId)),S&&!!o&&e.jsxs(k,{mx:"auto",children:["Dan ",o-t.length," kegiatan terselesaikan lainnya"]})]}):e.jsxs(p,{justify:"center",color:"gray.500",py:"3",children:[e.jsx(ye,{stroke:"1.2",size:"40"}),e.jsxs(k,{fontWeight:"500",fontSize:"lg",children:["Tidak ada ",d]})]}):Array(3).fill(null).map((j,h)=>e.jsx(ie,{h:"60.38px",w:"full"},h))})]},x))})}function Ue(){var o,t;const{user:u,screenType:s}=R(),c=(t=(o=u.view)==null?void 0:o.company)==null?void 0:t.companyId;if(!c)return e.jsx(le,{selectCompanyOnly:!0});const d=e.jsxs(p,{justify:"end",spacing:"4",wrap:"wrap",mb:"8px",children:[e.jsxs(v,{flex:"1 0 0",children:[e.jsx(z,{size:"lg",children:"Pencatatan"}),e.jsx(k,{color:"dimmed",children:"Catat seluruh kegiatan di pabrik Anda"})]}),e.jsx(be,{})]}),r=e.jsx(ve,{companyId:c});return e.jsxs(oe,{direction:s=="desktop"?"row":"column",gap:"3",children:[s=="desktop"&&e.jsx(v,{flex:"1 1 0",position:"relative",overflowY:"auto",className:"custom-scrollbar",children:e.jsxs(v,{position:"absolute",pr:"3",w:"full",children:[d,r]})}),s!=="desktop"&&d,e.jsx(v,{flex:{base:void 0,lg:"1 1 0"},h:{base:"400px",lg:"auto"},children:e.jsx(De,{companyId:c})}),s!=="desktop"&&r]})}export{Ue as default};
