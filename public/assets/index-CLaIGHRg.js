import{N as D,j as e,a0 as p,U as x,Y as k,r as C,$ as L,H as O,I,J as G,a9 as _,V as v,aa as V,S as q,X as J,ab as Q,ac as K,ad as X}from"./font-CsN-AIjb.js";import{M as N,a as Z}from"./index-DhxnfQxf.js";import{S as ee,C as ae,a as se,u as A,b as E,f as U,F as P,T as te,R as re,c as ne,d as F,m as oe,e as ie,A as le,M as ce,g as de,h as ue,i as me,j as he,k as pe,I as xe,l as R,n as ge,U as je}from"./app-Dr_tcMC0.js";import{C as fe}from"./chunk-RKXMPHPI-DFj6iGmy.js";import{S as z}from"./chunk-VTV6N5LE-DqVdfJQs.js";import{R as B}from"./RequiredIndicator-B5iXoidp.js";import{R as W,I as ye,a as ke}from"./ReportCard-D2XvWOUh.js";import{u as be,t as Ce,a as ve}from"./common.utils-DYrrUfov.js";import{u as Se,F as S,b as M,c as Me,a as we,d as Ie,e as Be}from"./index.esm-DItgFQ78.js";import{B as T,c as H,F as w,e as Fe,I as Y}from"./logo-white-DQaj3O9T.js";import{M as Re}from"./chunk-4FCEGNGT-CNeY54QQ.js";import{T as Te}from"./chunk-4IH3O7BJ-DxT5X1bM.js";import"./dateFormating-BPYUz-dC.js";import"./logo-dqb-qIY4.js";import"./TagWithIcon-CsRKeoTP.js";import"./IconMapPin-D36jdrOH.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var De=D("outline","camera-plus","IconCameraPlus",[["path",{d:"M12 20h-7a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}],["path",{d:"M9 13a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ae=D("outline","list","IconList",[["path",{d:"M9 6l11 0",key:"svg-0"}],["path",{d:"M9 12l11 0",key:"svg-1"}],["path",{d:"M9 18l11 0",key:"svg-2"}],["path",{d:"M5 6l0 .01",key:"svg-3"}],["path",{d:"M5 12l0 .01",key:"svg-4"}],["path",{d:"M5 18l0 .01",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Pe=D("outline","mood-neutral","IconMoodNeutral",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 10l.01 0",key:"svg-1"}],["path",{d:"M15 10l.01 0",key:"svg-2"}]]);const Oe=[{distance:250,label:"250 m"},{distance:500,label:"500 m"},{distance:1e3,label:"1 km"},{distance:2500,label:"2,5 km"}];function ze({isOpen:a,filterState:n,apiUrl:d}){const[o,t]=n;return e.jsx(p,{w:"full",children:e.jsx(fe,{in:a,animateOpacity:!0,children:e.jsxs(x,{spacing:"2",mt:"4",flexWrap:"wrap",children:[e.jsxs(p,{as:"label",flexGrow:"1",children:[e.jsx(k,{mb:"1",children:"Perusahaan"}),e.jsx(ee,{w:"full",fontWeight:"400",itemName:"Perusahaan",hiddenTitleButton:!0,apiUrl:d,_value:o.company,_onChange:s=>t(r=>({...r,company:s})),borderColor:"gray.200",color:"gray.700",displayRow:s=>e.jsxs(x,{children:[e.jsx(ae,{bg:"white",type:s.type}),e.jsx(k,{children:(s==null?void 0:s.name)||"Node yang Anda ikuti"})]})})]}),e.jsxs(p,{as:"label",flexGrow:"1",children:[e.jsx(k,{mb:"1",children:"Jarak"}),e.jsx(se,{w:"full",value:o.distance,onChange:s=>{t(r=>({...r,distance:parseInt(s.target.value)}))},children:Oe.map(s=>e.jsx("option",{value:s.distance,children:s.label},s.distance))})]})]})})})}function We({filterState:a,filterDisclosure:n,showCompaniesState:d,showCompaniesDisclosure:o}){const{user:t,roleIs:s}=A(),{isOpen:r,onToggle:l,onClose:h}=n,{isOpen:g,onToggle:j,onClose:b}=o,i=s(["admin","gov"])?"/companies?all=true&view=simple":`/users/${t.userId}/companies?all=true&view=simple`,{data:c}=E(o.isOpen?i:null,U);return C.useEffect(()=>{d[1]((c==null?void 0:c.rows)||[])},[c]),e.jsxs(p,{w:"full",children:[e.jsxs(x,{w:"full",justify:"space-between",children:[e.jsxs(P,{align:"center",children:[e.jsx(k,{fontWeight:"500",alignSelf:"start",children:"Tampilkan Lokasi Perusahaan"}),g&&!c&&e.jsx(L,{size:"sm",ml:"2",color:"gray.500"})]}),e.jsx(z,{onChange:f=>{f.target.checked&&h(),j()},isChecked:g})]}),e.jsxs(x,{w:"full",justify:"space-between",mt:"4",children:[e.jsx(k,{fontWeight:"500",alignSelf:"start",children:"Filter aduan di sekitar perusahaan Anda"}),e.jsx(z,{onChange:f=>{f.target.checked&&b(),l()},isChecked:r})]}),e.jsx(ze,{isOpen:r,apiUrl:i,filterState:a})]})}function Ye({rating:a,setRating:n}){const[d,o]=C.useState(0),t=d||a;let s=["Buruk sekali","Buruk","Biasa aja","Bagus","Bagus sekali"];return e.jsxs(x,{mx:"auto",w:"fit-content",children:[e.jsx(O,{border:"1px solid",borderColor:"gray.300",rounded:"lg",p:"2",children:e.jsx(I,{as:t?W[t-1].icon:Pe,color:t?W[t-1].color:"gray.400",boxSize:"50px"})}),e.jsxs(p,{children:[e.jsx(te,{children:t?s[t-1]:"Pilih Berapa Bintang"}),e.jsx(re,{onChange:r=>n(Number(r)),value:a.toString(),children:e.jsx(x,{spacing:"0",children:[...Array(5)].map((r,l)=>e.jsxs(O,{as:"label",p:"2",onMouseEnter:()=>o(l+1),onMouseLeave:()=>o(0),cursor:"pointer",children:[e.jsx(ne,{display:"none",value:(l+1).toString()},l),e.jsx(I,{as:ye,boxSize:"25px",color:l+1<=(d||a)?"yellow.400":"gray.300"})]},l))})})]})]})}function Le({values:a,onChange:n,...d}){const o=a.filter(t=>t);return e.jsxs(p,{...d,children:[e.jsx(P,{gap:"3",flexWrap:"wrap",children:a.map((t,s)=>e.jsxs(p,{position:"relative",flexGrow:"1",flexShrink:"0",w:"100px",h:"100px",children:[e.jsxs(T,{p:"0",w:"full",h:"full",as:"label",variant:"outline",overflow:"hidden",cursor:"pointer",children:[t?e.jsx(G,{objectFit:"cover",src:URL.createObjectURL(t)}):e.jsx(I,{as:De,boxSize:"30px",color:"gray.400"}),e.jsx(H,{type:"file",accept:"image/*",display:"none",onChange:r=>{n((()=>{let l=[...a];return r.target.files&&(l[s]=r.target.files[0]),l})())}})]}),t&&e.jsx(_,{size:"sm",onClick:()=>{n((()=>{let r=[...a];return r[s]=null,r})())},bg:"gray.300",position:"absolute",top:"10px",right:"10px"})]},s))}),e.jsx(k,{mt:"2",fontSize:"sm",children:o.length?o.length+" Foto ditambahkan":"Belum ada foto yang ditambahkan"})]})}const Ne=Me().shape({message:we().max(255,"Terlalu Panjang").required("Wajib Diisi"),rating:Ie().required("Wajib Diisi"),coordinate:Be().test("","Anda Belum menentukan titik koordinat",a=>a&&a.filter(n=>n).length==2)});function Ee(){const{user:a}=A(),{isOpen:n,onOpen:d,onClose:o}=F(),t=be(),{handleChange:s,handleBlur:r,isSubmitting:l,values:h,setFieldValue:g,setSubmitting:j,resetForm:b,touched:i,errors:c,handleSubmit:f}=Se({initialValues:{message:"",rating:0,coordinate:[NaN,NaN],images:[null,null,null]},validationSchema:Ne,onSubmit:async u=>{const y=await Promise.all(u.images.filter(m=>m).map(m=>Ce(m)));oe.post("/reports",ve({...u,images:y})).then(()=>{t.success("Aduan berhasil dikirim"),ie(m=>typeof m=="string"&&m.startsWith("/reports"),null,{revalidate:!0})}).catch(()=>t.success("Ada yang salah, aduan gagal dikirim")).finally(()=>{o(),j(!1),b()})}});return e.jsxs(e.Fragment,{children:[e.jsxs(x,{rounded:"md",bg:"white",w:"full",color:"gray.500",justifyContent:"start",cursor:"pointer",onClick:d,children:[e.jsx(le,{boxSize:"37px",name:a.name,src:a.profilePicture}),e.jsx(p,{fontWeight:"400",border:"1px solid",borderColor:"gray.300",px:"4",py:"2",w:"full",rounded:"full",children:"Buat Aduan"})]}),e.jsx(ce,{size:"2xl",isOpen:n,onClose:o,scrollBehavior:"inside",closeOnEsc:!1,children:e.jsxs("form",{onSubmit:f,children:[e.jsx(de,{}),e.jsxs(ue,{children:[e.jsx(me,{borderBottom:"1px solid",borderColor:"gray.200",children:"Posting Aduan"}),e.jsx(Re,{}),e.jsx(he,{children:e.jsxs(v,{mx:"auto",spacing:"2",maxW:"container.sm",mt:"4",children:[e.jsxs(w,{isInvalid:!!c.message&&i.message,children:[e.jsxs(S,{children:["Tuis Pesan ",e.jsx(B,{})]}),e.jsx(Te,{id:"message",name:"message",placeholder:"Tulis kuaitas udara yang anda rasakan saat ini",onChange:s,onBlur:r}),e.jsx(M,{children:c.message})]}),e.jsxs(w,{isInvalid:!!c.rating&&i.rating,children:[e.jsxs(S,{children:["Pilih Bintang ",e.jsx(B,{})]}),e.jsx(Ye,{rating:h.rating,setRating:u=>g("rating",u),size:2}),e.jsx(M,{children:c.rating})]}),e.jsxs(w,{isInvalid:!!c.coordinate&&i.coordinate,children:[e.jsxs(S,{children:["Lokasi ",e.jsx(B,{})]}),e.jsx(Fe,{children:"Geser peta dan paskan penanda ke titik yang dimaksud"}),e.jsx(N,{scrollWheelZoom:!1,mt:"3",data:[],outline:c.coordinate&&i.coordinate?"2px solid":"",outlineColor:"#E53E3E",isEditing:{coordinate:h.coordinate.filter(u=>u).length?h.coordinate:V,onChange:u=>g("coordinate",[u.lat,u.lng])}}),e.jsx(M,{children:c.coordinate})]}),e.jsxs(w,{isInvalid:!!c.images&&i.images,children:[e.jsx(S,{children:"Foto"}),e.jsx(Le,{values:h.images,onChange:u=>g("images",u)}),e.jsx(M,{children:c.images})]})]})}),e.jsxs(pe,{borderTop:"1px solid",borderColor:"gray.200",children:[e.jsx(T,{onClick:()=>{b(),o()},children:"Batal"}),e.jsx(T,{colorScheme:"blue",ml:3,type:"submit",isLoading:l,children:"Kirim"})]})]})]})})]})}function Ue({pagination:a,dateState:n}){const[d,o]=n,t=a==null?void 0:a.next,s=a==null?void 0:a.previous,r=a==null?void 0:a.current;return e.jsxs(x,{justify:"space-between",w:"full",children:[e.jsx(Y,{variant:"outline",icon:e.jsx(xe,{}),"aria-label":"previous",isDisabled:!s,onClick:()=>s?o(s):null}),e.jsx(H,{variant:"outline",onFocus:l=>l.target.showPicker(),type:"date",textAlign:"center",max:R().format("YYYY-MM-DD"),onChange:l=>o(l.target.value),value:r||d}),e.jsx(Y,{variant:"outline",icon:e.jsx(ge,{}),"aria-label":"next",isDisabled:!t,onClick:()=>t?o(t):null})]})}const He=(a,n)=>!n.company||!a?{}:{nearCompany:n.company.companyId,distance:n.distance};function oa(){const{roleIsNot:a,screenType:n}=A(),d=F(),o=F(),t=C.useRef(),s=R().format("YYYY-MM-DD"),[r,l]=C.useState({distance:250}),[h,g]=C.useState([]),[j,b]=C.useState(s),{data:i,isLoading:c}=E(je("/reports",{date:j,...He(d.isOpen,r)}),U),f=e.jsx(q,{w:"full",size:"md",children:e.jsx(J,{children:e.jsxs(v,{spacing:"4",children:[e.jsx(Ee,{}),e.jsx(Ue,{pagination:i==null?void 0:i.pagination,dateState:[j,b]}),a("regular")&&e.jsx(We,{filterState:[r,l],filterDisclosure:d,showCompaniesState:[h,g],showCompaniesDisclosure:o})]})})}),u=e.jsxs(Q,{boxShadow:"sm",fontSize:"md",rounded:"md",variant:"left-accent",alignItems:"start",children:[c?e.jsx(L,{thickness:"2px",colorScheme:"blue",mt:"1px",boxSize:"20px",mr:"3"}):e.jsx(K,{mt:"1px"}),e.jsx(X,{children:c?"Mengambil Data...":((i==null?void 0:i.result.length)||"Tidak ada")+(j===s?" aduan di 24 jam terakhir":" aduan pada tanggal "+R(j).format("DD MMM YYYY"))})]}),y=i==null?void 0:i.result.map((m,$)=>e.jsx(ke,{data:m,map:t.current},$));return e.jsxs(P,{direction:n=="desktop"?"row":"column",gap:"3",children:[n=="desktop"&&e.jsx(p,{flex:"2 0 0",position:"relative",overflowY:"auto",className:"custom-scrollbar",children:e.jsxs(v,{spacing:"3",position:"absolute",pr:"2",w:"full",children:[f,u,y]})}),n!="desktop"&&e.jsxs(v,{spacing:"3",children:[f,u]}),e.jsx(N,{flex:"3 0 0",h:"auto",minH:{base:"400px",lg:"auto"},marker:Z.RatingMarker,companiesData:o.isOpen?h:d.isOpen&&r.company?[r.company]:[],circleBoundaryRadius:d.isOpen?r.distance:void 0,data:(i==null?void 0:i.result.map(m=>({isReport:!0,...m})))||[],mapRef:t}),n!=="desktop"&&!!(y!=null&&y.length)&&e.jsxs(v,{spacing:"3",children:[e.jsxs(x,{alignSelf:"start",children:[e.jsx(I,{boxSize:"1.2em",as:Ae}),e.jsx(k,{alignSelf:"start",fontWeight:"600",fontSize:"lg",children:"Daftar Aduan"})]}),y]})]})}export{oa as default};
