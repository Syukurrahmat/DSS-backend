import{r as b,j as a,D as H,N as y,J as _,T as i,E as S,L as O,H as f,V as G,Z as t,Q as B,a1 as Q,a2 as Z,C as J}from"./createReactComponent-m2GCamtz.js";import{R as d}from"./RequiredIndicator-DdPXie2d.js";import{M as K}from"./index-Dt6lv0Jl.js";import{B as A}from"./BigAlert-ClPlFLp7.js";import{s as Y,Y as X,Z as aa,c as ea,Q as sa,S as na,U as ia,C as T,F as ta,R as oa,_ as ra,x as da}from"./app-BlQRCkbL.js";import{M as F}from"./MyRadio-Do7ujEfU.js";import{a as la}from"./common.utils-BXgvsAbj.js";import{n as E,d as W,b as ca}from"./validator.utils-BSOb9322.js";import{u as ma}from"./formik.esm-X4pWCQgU.js";import{F as o,b as u,c as P,f as R,e as ha,d as ua}from"./index.esm-DXWgZSHY.js";import{I as pa}from"./IconInfoCircle-DF-YfKml.js";import{T as xa,a as ja,b as ga,c as ba,d as fa}from"./chunk-IAXSQ4X2-BWbuaJl8.js";import{T as M}from"./chunk-4IH3O7BJ-BSUfzZnZ.js";import"./dateFormating-CjiM6gKV.js";import"./index.tags-vBYpzwqj.js";import"./TagWithIcon-BmQxVHBm.js";import"./chunk-V7PAE35Z-BuEgg6Tf.js";import"./IconCirclePlus-D9W8Q483.js";import"./index-B4MCLp8v.js";const ka=P().shape({name:E.required("Wajib diisi"),description:W.required("Wajib diisi"),address:ca.required("Wajib diisi"),instalationDate:R().nullable(),coordinate:ha().test("","Anda Belum menentukan titik koordinat",p=>p&&p.filter(l=>l).length==2)}),ya=P().shape({companyId:ua().required("Wajib diisi"),name:E.required("Wajib diisi"),description:W.required("Wajib diisi"),instalationDate:R().nullable()});function qa(){var C;const p=Y(),l=!!X("/nodes/create"),[k,w]=b.useState({}),[c,D]=b.useState(l?0:1),n=(C=p.state)==null?void 0:C.company;if(!l&&!n)return a.jsx(aa,{to:"..",relative:"path"});const L=c?ya:ka,{handleChange:x,handleBlur:j,values:U,touched:m,status:r,setStatus:N,setFieldValue:g,resetForm:I,setSubmitting:V,isSubmitting:q,errors:s,handleSubmit:$}=ma({initialValues:{name:"",description:"",address:"",status:"active",instalationDate:"",coordinate:[NaN,NaN],companyId:n.companyId||NaN},validationSchema:L,onSubmit:e=>{ea.post(`${H}/nodes`,la(e)).then(({data:h})=>N(h||!1)).catch(()=>N(!1)).finally(()=>V(!1))}});b.useEffect(()=>{g("companyId",k.companyId)},[k]),b.useEffect(()=>{g("companyId",n.companyId||NaN)},[]);const v=[{icon:ra,name:"Node Publik",note:"Membuat node Publik yang dapat digunakan oeh semua user"},{icon:da,name:"Node Private",note:"Membuat node private hanya suatu usaha spesifik"}];return a.jsxs(y,{children:[a.jsx(_,{size:"lg",children:"Buat Sensor"}),a.jsx(i,{children:"Buat sensor untuk menambah akurasi sistem"}),a.jsxs(S,{maxW:"container.md",mt:"4",children:[r===void 0&&l&&a.jsxs(xa,{index:c,onChange:D,variant:"soft-rounded",colorScheme:"blue",children:[a.jsx(ja,{gap:"4",children:v.map(({name:e,icon:h},z)=>a.jsxs(ga,{rounded:"md",children:[a.jsx(O,{as:h,boxSize:"20px"}),a.jsx(i,{ml:"2",children:e})]},z))}),a.jsx(sa,{mt:"2",border:"1px solid",borderColor:"gray.400"}),a.jsx(ba,{children:v.map(({note:e},h)=>a.jsxs(fa,{px:"0",as:f,spacing:"1",children:[a.jsx(pa,{size:"20"}),a.jsx(i,{ml:"2",children:e})]},h))})]}),r!==void 0?r?a.jsx(A,{status:"success",title:"Node berhasil dibuat",description:"Node siap untuk digunakan dalam sistem Anda",onCreateAgain:I,itemName:"node",detailPageURL:`/nodes/${r==null?void 0:r.result.nodeId}`}):a.jsx(A,{status:"warning",title:"Node gagal didaftarkan",description:"Ada yang salah. Hubungi Administrator",onCreateAgain:I}):a.jsx(S,{maxW:"container.sm",children:a.jsx("form",{onSubmit:$,className:"my-form",children:a.jsxs(G,{mx:"auto",spacing:"2",maxW:"container.sm",pb:"1000px",children:[c&&(n?a.jsxs(y,{alignSelf:"start",children:[a.jsx(i,{fontWeight:"600",children:"Buat Node Untuk Usaha"}),a.jsxs(f,{mt:"2",spacing:"3",shadow:"xs",p:"3",bg:"white",rounded:"md",children:[a.jsx(T,{type:n.type,size:"24px"}),a.jsxs(y,{children:[a.jsx(i,{fontWeight:"600",pr:"2",children:n.name}),a.jsx(i,{children:ta[n.type].name})]})]})]}):a.jsxs(t,{children:[a.jsxs(o,{children:["Pilih Usaha ",a.jsx(d,{})]}),a.jsx(na,{leftIcon:a.jsx(ia,{size:"30"}),itemName:"Usaha",apiUrl:"/search/companies",selectValue:k,selectOnChange:w,displayRow:e=>a.jsxs(f,{children:[a.jsx(T,{bg:"white",type:e.type}),a.jsx(i,{children:(e==null?void 0:e.name)||"Node yang Anda ikuti"})]})}),a.jsx(u,{children:s.companyId})]})),a.jsxs(t,{isInvalid:!!s.name&&m.name,children:[a.jsxs(o,{children:["Nama Node ",a.jsx(d,{})]}),a.jsx(B,{id:"name",name:"name",placeholder:"Misal : Belakang rumah pak Subegja",onChange:x,onBlur:j}),a.jsx(u,{children:s.name})]}),a.jsxs(t,{isInvalid:!!s.description&&m.description,children:[a.jsxs(o,{children:["Deskripsi node ",a.jsx(d,{})]}),a.jsx(M,{id:"description",name:"description",placeholder:"Masukkan deskripsi node, singkat saja",onChange:x,onBlur:j}),a.jsx(u,{children:s.description})]}),!c&&a.jsx(a.Fragment,{children:a.jsxs(t,{isInvalid:!!s.address&&m.address,children:[a.jsxs(o,{children:["Alamat node ",a.jsx(d,{})]}),a.jsx(M,{id:"address",name:"address",placeholder:"Masukkan Alamat Node berada",onChange:x,onBlur:j}),a.jsx(u,{children:s.address})]})}),a.jsxs(t,{children:[a.jsx(o,{children:"Tanggal Instalasi"}),a.jsx(B,{w:"fit-content",type:"date",id:"instalationDate",name:"instalationDate",onChange:x,onBlur:j})]}),a.jsxs(t,{children:[a.jsxs(o,{children:["Status Node ",a.jsx(d,{})]}),a.jsx(oa,{onChange:e=>g("status",e),value:U.status,children:a.jsxs(f,{spacing:4,children:[a.jsx(F,{value:"active",children:"Aktifkan"}),a.jsx(F,{value:"nonactive",children:"Nonaktifkan"})]})})]}),!c&&a.jsx(a.Fragment,{children:a.jsxs(t,{isInvalid:!!s.coordinate&&m.coordinate,children:[a.jsxs(o,{children:["Koordinat Node ",a.jsx(d,{})]}),a.jsx(Q,{children:"Geser peta dan paskan penanda ke titik yang dimaksud"}),a.jsx(K,{mt:"3",data:[],outline:s.coordinate&&m.coordinate?"2px solid":"",outlineColor:"#E53E3E",isEditing:{coordinate:Z,onChange:e=>g("coordinate",[e.lat,e.lng])}}),a.jsx(u,{children:s.coordinate})]})}),a.jsx(J,{isLoading:q,w:"full",mt:"4",colorScheme:"green",type:"submit",children:"Buat Akun"})]})})})]})]})}export{qa as default};
