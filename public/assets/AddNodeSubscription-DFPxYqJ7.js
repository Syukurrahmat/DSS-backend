import{N as O,r as f,j as e,V as S,W as F,U as C,a0 as W,Z as P,Y as j}from"./font-CsN-AIjb.js";import{a9 as A,T as M,aa as I,ab as E,d as $,ac as V,b as N,f as T,M as q,g as Q,h as X,i as Y,j as Z,ad as _,O as G,W as B,k as J,m as K,e as y}from"./app-ZJ9y3HmT.js";import{b as ee,g as ae,P as se,M as ne}from"./index-CQsnPMS7.js";import{u as te}from"./common.utils-DYrrUfov.js";import{B as g}from"./logo-white-DQaj3O9T.js";import{M as oe}from"./chunk-4FCEGNGT-C-BMRY63.js";/**
 * @license @tabler/icons-react v3.1.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=O("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);const le=(n,r)=>{function o({properties:a,...d}){const i=f.useRef(),{nodeId:h}=a,p=!!n.find(l=>l.nodeId==h),x=()=>{var l;(l=i.current)==null||l.closePopup(),setTimeout(()=>{const{name:b,nodeId:c}=a;r({name:b,nodeId:c})},300)};return e.jsx(ee,{icon:ae(a.isSubscribed?"subscribed":p?"selected":"unselected"),ref:i,...d,children:e.jsx(se,{className:"map-popup",offset:[0,-16],children:e.jsxs(S,{align:"start",spacing:"1",children:[e.jsx(F,{size:"sm",textTransform:"capitalize",children:a.name}),e.jsx(C,{mb:"2",children:e.jsx(A,{value:a.isUptodate})}),a.isSubscribed?e.jsx(M,{variant:"outline",w:"full",children:e.jsx(I,{w:"full",textAlign:"center",children:"Sudah diikuti"})}):p?e.jsx(g,{leftIcon:e.jsx(E,{size:"14"}),colorScheme:"red",size:"xs",w:"full",onClick:x,children:"Batal Pilih"}):e.jsx(g,{leftIcon:e.jsx(ie,{size:"14"}),colorScheme:"blue",size:"xs",w:"full",onClick:x,children:"Pilih Node"})]})})})}return o};function xe({subsInfo:n,...r}){const o=te(),[a,d]=f.useState([]),[i,h]=f.useState(!1),{isOpen:p,onOpen:x,onClose:l}=$(),b=n.type==="user"?`/users/${n.userId}`:`/companies/${n.companyData.companyId}`,c=b+"/nodes",R=b+"/dashboard",v=n.type==="user"?{forUserSubs:n.userId}:{forCompanySubs:n.companyData.companyId},w=`/nodes/subscribeable?${V.stringify(v)}`,D=`${c}/limit`,{data:u,mutate:k}=N(D,T),H=()=>o.opss(`Node yang diikuti dibatasi maksimal 5 node, 
Hapus node yang lain terlebih dahulu untuk menambahkan `),U=t=>{if(u!==void 0){if(a.length>=u)return H();d(s=>s.find(m=>m.nodeId==t.nodeId)?s.filter(m=>m.nodeId!==t.nodeId):[...s,t])}},z=async()=>{if(!a.length)return o.opss("Sepertinya Anda belum menambahkan Node");h(!0);const t=a.map(s=>s.nodeId);K.patch(c,{nodeIds:t}).then(()=>{o.success(t.length+" node publik berhasil ditambahkan"),y(s=>typeof s=="string"&&s.startsWith(c)),y(s=>typeof s=="string"&&s.startsWith(R)),k(s=>(s||0)-t.length)}).catch(()=>{o.error("Node publik gagal ditambahkan")}).finally(()=>{h(!1),l()})};return e.jsxs(e.Fragment,{children:[e.jsx(W,{onClick:()=>{x(),k()},children:r.children}),e.jsxs(q,{closeOnEsc:!1,closeOnOverlayClick:!1,size:"5xl",isOpen:p,onClose:l,onCloseComplete:()=>d([]),children:[e.jsx(Q,{}),e.jsxs(X,{children:[e.jsx(Y,{children:"Tambah Ikuti Node Publik"}),!i&&e.jsx(oe,{}),e.jsx(Z,{py:"0",children:u!==void 0?e.jsx(e.Fragment,{children:u?e.jsxs(e.Fragment,{children:[e.jsxs(P,{mb:"3",direction:{base:"column-reverse",md:"row"},align:"stretch",children:[e.jsx(C,{minH:"35px",py:"1",px:"2",flex:"1 0 0",wrap:"wrap",rounded:"md",border:"1px solid",borderColor:"gray.200",children:a.length?a.map(({nodeId:t,name:s})=>e.jsxs(M,{colorScheme:"blue",w:"fit-content",children:[e.jsx(I,{children:s}),e.jsx(_,{onClick:()=>d(m=>m.filter(L=>L.nodeId!==t))})]},t)):e.jsx(j,{color:"gray.500",children:"Belum ada Node yang dipilih"})}),e.jsx(G,{width:{base:"full",md:"250px"},_onSubmit:null,placeholder:"Cari node"})]}),e.jsx(de,{selectedNodes:a,onSelectChange:U,apiURL:w,companyData:n.type=="company"?n.companyData:void 0})]}):e.jsxs(S,{children:[e.jsx(j,{fontWeight:"600",fontSize:"lg",children:"Node yang diikuti dibatasi maksimal 5 node,"}),e.jsx(j,{children:"Hapus node yang lain terlebih dahulu untuk menambahkan"})]})}):e.jsx(B,{h:"300px",rounded:"md"})}),e.jsxs(J,{children:[e.jsx(g,{colorScheme:"gray",mr:3,isDisabled:i,onClick:l,children:"Batal"}),!!u&&e.jsx(g,{isLoading:i,colorScheme:"blue",onClick:z,children:"Tambahkan"})]})]})]})]})}function de(n){const{selectedNodes:r,companyData:o,onSelectChange:a,apiURL:d}=n,{data:i}=N(d,T);return e.jsx(e.Fragment,{children:e.jsx(ne,{focusInOneCompany:!0,companiesData:o?[o]:[],marker:le(r,a),data:i||[],as:i?void 0:B,centerAuto:!1})})}export{xe as N};
